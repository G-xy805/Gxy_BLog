---
import { getEntry, render } from "astro:content";
import Comment from "@components/comment/index.astro";
import Markdown from "@components/misc/Markdown.astro";
import Icon from "@/components/misc/Icon.astro";
import { getEnabledFriends } from "@/config";
import MainGridLayout from "@/layouts/MainGridLayout.astro";

const friendsPost = await getEntry("spec", "friends");

if (!friendsPost) {
	throw new Error("friends page content not found");
}

const { Content } = await render(friendsPost);

// 使用配置文件中的友链数据，按权重排序
const items = getEnabledFriends();

// 页面标题
const title = "友人帐";
---

<MainGridLayout title={title}>
  <!-- 友链卡片 -->
  <div
    class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32 mb-4"
  >
    <div class="card-base z-10 px-8 py-6 relative w-full">
      <!-- 页面标题和描述 -->
      <div class="mb-8">
        <div class="flex items-center gap-2 mb-3">
          <Icon icon="feather:users" size="2xl" class="text-primary dark:text-[var(--primary)]" />
          <h2 class="text-2xl font-bold text-[#394E6A] dark:text-neutral-100">
            {title}
          </h2>
        </div>
      </div>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 my-4">
        {
          items.map((item) => (
            <a
              href={item.siteurl}
              target="_blank"
              rel="noopener noreferrer"
              class="group relative block h-full rounded-2xl p-4 bg-white dark:bg-[#1A1B26] transition-all duration-300 hover:-translate-y-1 shadow-lg hover:shadow-xl"
            >
              <div class="flex items-center gap-4 h-full">
                <!-- 头像 -->
                <div class="relative shrink-0">
                  <div class="w-16 h-16 rounded-full overflow-hidden">
                    <img
                      src={item.imgurl}
                      alt={item.title}
                      class="w-full h-full object-cover"
                    />
                  </div>
                </div>

                <div class="flex-1 min-w-0 flex flex-col justify-center">
                  <div class="flex items-center justify-between mb-1">
                    <h3 class="font-bold text-base text-[#394E6A] dark:text-neutral-100 group-hover:text-[var(--primary)] transition-colors duration-300 truncate pr-2">
                      {item.title}
                    </h3>
                  </div>
                  
                  <p class="text-sm text-[#566880] dark:text-[#D9DAD6] line-clamp-2 leading-relaxed">
                    {item.desc}
                  </p>
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </div>
  
  <!-- 本站信息卡片 -->
  <div
    class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32"
  >
    <div class="card-base z-10 px-8 py-6 relative w-full">
      <!-- 页面标题和描述 -->
      <div class="mb-8">
        <div class="flex items-center gap-2 mb-3">
          <Icon icon="feather:link" size="2xl" class="text-primary dark:text-[var(--primary)]" />
          <h2 class="text-2xl font-bold text-[#394E6A] dark:text-neutral-100">
            友链申请
          </h2>
        </div>
      </div>
      
      <Markdown class="my-4 friends-page">
        <Content />
      </Markdown>
    </div>
  </div>

  <!-- 评论区 -->
  <div class="mt-4">
    <Comment post={friendsPost} customPath="/friends/" />
  </div>
</MainGridLayout>
