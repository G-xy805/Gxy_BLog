---
import ArchivePanel from "@components/interactive/ArchivePanel.svelte";
import Icon from "@components/misc/Icon.astro";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import MainGridLayout from "@/layouts/MainGridLayout.astro";
import { getSortedPostsList } from "@/utils/content-utils";

const sortedPostsList = await getSortedPostsList();

const minimalPostsList = sortedPostsList.map((post) => ({
	id: post.id,
	data: {
		title: post.data.title,
		tags: post.data.tags,
		category: post.data.category,
		published: post.data.published,
	},
}));

// 统计总文章数
const totalPosts = sortedPostsList.length;
---

<MainGridLayout title={i18n(I18nKey.archive)}>
  <div class="card-base mb-4 px-4 py-4 md:px-6 md:py-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 md:gap-6">
      <!-- 左侧信息 -->
      <div class="flex items-center gap-4 md:gap-6 w-full">
        <!-- 图标容器 -->
        <div class="flex items-center justify-center w-12 h-12 md:w-14 md:h-14 rounded-xl bg-[var(--primary)]/10 text-[var(--primary)] shrink-0">
          <Icon icon="ri:archive-line" class="w-full h-full" />
        </div>
        
        <!-- 文字信息 -->
        <div class="flex flex-col justify-center min-w-0 flex-1">
          <div class="flex items-center gap-2 md:gap-3 flex-wrap">
              <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold text-black/90 dark:text-white/90 leading-tight">{i18n(I18nKey.archive)}</h1>
              <div class="gradient-badge text-xs md:text-sm px-2 py-0.5">
                  {totalPosts} {i18n(totalPosts === 1 ? I18nKey.postCount : I18nKey.postsCount)}
              </div>
          </div>
          <div class="text-xs text-black/50 dark:text-white/50 mt-1 md:mt-1.5">
              按日期浏览文章
          </div>
        </div>
      </div>

      <!-- 右侧按钮 -->
      <div class="w-full md:w-auto flex md:block">
        <a href="/" class="w-full md:w-auto hover-button transition-all duration-300 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-white font-bold text-sm md:text-base whitespace-nowrap">
          <Icon icon="ri:book-open-line" class="w-5 h-5 shrink-0" />
          <span class="whitespace-nowrap">{i18n(I18nKey.backToBlog)}</span>
        </a>
      </div>
    </div>
  </div>
  <div class="card-base mt-4 archive-panel-card">
    <ArchivePanel sortedPosts={minimalPostsList} client:only="svelte" />
  </div>
</MainGridLayout>
