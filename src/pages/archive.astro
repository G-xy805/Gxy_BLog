---
import ArchivePanel from "@components/interactive/ArchivePanel.svelte";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import MainGridLayout from "@/layouts/MainGridLayout.astro";
import { getSortedPostsList } from "@/utils/content-utils";
import Icon from "@components/misc/Icon.astro";

const sortedPostsList = await getSortedPostsList();

const minimalPostsList = sortedPostsList.map((post) => ({
	id: post.id,
	data: {
		title: post.data.title,
		tags: post.data.tags,
		category: post.data.category,
		published: post.data.published,
	},
}));

// 统计总文章数
const totalPosts = sortedPostsList.length;
---

<MainGridLayout title={i18n(I18nKey.archive)}>
  <div class="card-base mb-0">
    <div class="px-6 py-6">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div class="flex items-center gap-2">
          <Icon icon="feather:archive" class="text-[#C148AC] dark:text-[#FFB86C]" size="2xl" />
          <h1 class="text-3xl font-bold text-[#394E6A] dark:text-[#F8F8F2]">{i18n(I18nKey.archive)}</h1>
          <div class="badge rounded-full bg-[#C148AC] text-white dark:bg-[#FFB86C] dark:text-black text-[0.8rem] px-4 py-0.4">{totalPosts} {i18n(totalPosts === 1 ? I18nKey.postCount : I18nKey.postsCount)}</div>
        </div>
        <a href="/" class="transition-all duration-300 inline-flex items-center justify-center gap-1 px-3 py-1.5 border border-[#394E6A] text-[#394E6A] text-sm font-bold rounded-lg hover:bg-[#394E6A] hover:text-white dark:border-white dark:text-white dark:hover:bg-white dark:hover:text-black">
          <Icon icon="feather:book-open" class="w-4 h-4" />
          <span class="mr-1">{i18n(I18nKey.backToBlog)}</span>
        </a>
      </div>
      <div class="divider my-6"></div>
      <div class="border-t border-[1.5px] border-[#EBEDF0] dark:border-[rgba(255,255,255,0.2)] mt-4 mb-6"></div>
      <div class="text-sm text-[#6B7A8F] dark:text-[#C5C5C3]">按日期浏览文章</div>
    </div>
  </div>
  <div class="card-base mt-4">
    <ArchivePanel sortedPosts={minimalPostsList} client:only="svelte" />
  </div>
</MainGridLayout>
