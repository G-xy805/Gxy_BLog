---
title: 33.Cä»£ç ä¸­å¼•ç”¨C++ä»£ç æœ‰æ—¶å€™ä¼šæŠ¥é”™ä¸ºä»€ä¹ˆï¼Ÿ
order: 33
description: è¯¦è§£Cä»£ç å¼•ç”¨C++ä»£ç æ—¶çš„ç¼–è¯‘é”™è¯¯åŸå› åŠè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å‘½åä¿®é¥°ã€extern Cçš„ä½¿ç”¨ç­‰
published: '2026-01-23'
image: /assets/images/cpp-logo.webp
tags:
- C++
- ç¼–è¯‘åŸç†
- extern C
- æ··åˆç¼–ç¨‹
category: C++
---
# ğŸ”¬ Cä»£ç ä¸­å¼•ç”¨C++ä»£ç æœ‰æ—¶å€™ä¼šæŠ¥é”™ä¸ºä»€ä¹ˆï¼Ÿ
## ğŸ“– å†…å®¹æ¦‚è§ˆ

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

## ğŸ”„ åŠŸèƒ½è¯¦è§£

## âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ æ³¨æ„äº‹é¡¹

## ğŸ’¡ å…³é”®è¦ç‚¹

## ğŸ“‹ æ€»ç»“


ğŸ“– **å†…å®¹æ¦‚è§ˆ**
- Cå’ŒC++æ··åˆç¼–ç¨‹çš„å¸¸è§é”™è¯¯åŸå› 
- å‘½åä¿®é¥°ï¼ˆName Manglingï¼‰çš„åŸç†å’Œå½±å“
- extern "C"çš„ä½œç”¨å’Œä½¿ç”¨æ–¹æ³•
- æ··åˆç¼–ç¨‹çš„æœ€ä½³å®è·µ
- å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

ğŸ¯ **æ ¸å¿ƒæ¦‚å¿µ**

## ğŸ“Œ 1. Cå’ŒC++æ··åˆç¼–ç¨‹çš„èƒŒæ™¯

Cå’ŒC++æ˜¯ä¸¤ç§ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œè™½ç„¶C++å…¼å®¹å¤§éƒ¨åˆ†Cè¯­æ³•ï¼Œä½†å®ƒä»¬åœ¨ç¼–è¯‘å’Œé“¾æ¥æœºåˆ¶ä¸Šå­˜åœ¨æœ¬è´¨åŒºåˆ«ã€‚å½“Cä»£ç è¯•å›¾å¼•ç”¨C++ä»£ç æ—¶ï¼Œè¿™äº›å·®å¼‚ä¼šå¯¼è‡´ç¼–è¯‘æˆ–é“¾æ¥é”™è¯¯ã€‚

## ğŸ“Œ 2. æŠ¥é”™çš„ä¸»è¦åŸå› 

### 2.1 å‘½åä¿®é¥°ï¼ˆName Manglingï¼‰å·®å¼‚

**è¿™æ˜¯æœ€ä¸»è¦çš„åŸå› ï¼**

- **Cç¼–è¯‘å™¨**ï¼šç”Ÿæˆçš„å‡½æ•°åä¿æŒåŸæ ·ï¼Œå¦‚`void func(int)`ä¼šè¢«ç¼–è¯‘ä¸º`_func`ï¼ˆä¸åŒç¼–è¯‘å™¨å¯èƒ½ç•¥æœ‰ä¸åŒï¼‰
- **C++ç¼–è¯‘å™¨**ï¼šä¼šå¯¹å‡½æ•°åè¿›è¡Œ**å‘½åä¿®é¥°**ï¼ˆä¹Ÿç§°ä¸ºåç§°ç²‰ç¢ï¼‰ï¼Œç”¨äºæ”¯æŒå‡½æ•°é‡è½½ã€å‘½åç©ºé—´ç­‰ç‰¹æ€§
  - ä¾‹å¦‚`void func(int)`å¯èƒ½ä¼šè¢«ç¼–è¯‘ä¸º`_Z4funci`
  - `void func(double)`å¯èƒ½ä¼šè¢«ç¼–è¯‘ä¸º`_Z4funcd`

å½“Cä»£ç è°ƒç”¨C++å‡½æ•°æ—¶ï¼ŒCç¼–è¯‘å™¨ä¼šæŒ‰ç…§Cçš„å‘½åè§„åˆ™ç”Ÿæˆå‡½æ•°è°ƒç”¨ï¼Œè€Œé“¾æ¥å™¨æ‰¾ä¸åˆ°å¯¹åº”çš„å‡½æ•°åï¼Œå¯¼è‡´**é“¾æ¥é”™è¯¯**ã€‚

### 2.2 ç±»å‹ç³»ç»Ÿå·®å¼‚

- C++æ”¯æŒæ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- C++æœ‰é¢å¤–çš„ç±»å‹ï¼ˆå¦‚boolã€å¼•ç”¨ã€æ¨¡æ¿ç­‰ï¼‰
- C++çš„æšä¸¾ç±»å‹åœ¨C++11åé»˜è®¤æœ‰ä½œç”¨åŸŸ
- C++çš„void*ä¸èƒ½éšå¼è½¬æ¢ä¸ºå…¶ä»–æŒ‡é’ˆç±»å‹

### 2.3 å…³é”®å­—å†²çª

C++å¼•å…¥äº†ä¸€äº›Cè¯­è¨€ä¸­ä¸å­˜åœ¨çš„å…³é”®å­—ï¼Œå¦‚ï¼š
- `new`ã€`delete`
- `class`ã€`namespace`ã€`template`
- `bool`ã€`true`ã€`false`
- `virtual`ã€`override`ã€`final`

å¦‚æœCä»£ç ä¸­ä½¿ç”¨äº†è¿™äº›å…³é”®å­—ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œè€Œåˆå¼•ç”¨äº†C++å¤´æ–‡ä»¶ï¼Œå°±ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

### 2.4 å†…å­˜ç®¡ç†æœºåˆ¶å·®å¼‚

- C++ä½¿ç”¨`new`/`delete`è¿›è¡Œå†…å­˜ç®¡ç†
- Cä½¿ç”¨`malloc`/`free`è¿›è¡Œå†…å­˜ç®¡ç†
- ä¸¤è€…çš„å†…å­˜åˆ†é…ç­–ç•¥ä¸åŒï¼Œæ··ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼æˆ–å´©æºƒ

### 2.5 å¼‚å¸¸å¤„ç†æœºåˆ¶

- C++æ”¯æŒå¼‚å¸¸å¤„ç†ï¼ˆtry-catch-throwï¼‰
- Cä¸æ”¯æŒå¼‚å¸¸å¤„ç†
- å¦‚æœCä»£ç è°ƒç”¨çš„C++å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼ŒCä»£ç æ— æ³•æ•è·ï¼Œä¼šå¯¼è‡´ç¨‹åºå´©æºƒ

ğŸ’» **ä»£ç ç¤ºä¾‹**

## ğŸ“Œ 3. é—®é¢˜æ¼”ç¤ºä¸è§£å†³æ–¹æ¡ˆ

### 3.1 é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥å¼•ç”¨C++ä»£ç 

**C++å¤´æ–‡ä»¶ï¼ˆcpp_func.hï¼‰**ï¼š
```cpp
// è¿™æ˜¯ä¸€ä¸ªC++å¤´æ–‡ä»¶
void cpp_function(int x, double y);
```

**C++æºæ–‡ä»¶ï¼ˆcpp_func.cppï¼‰**ï¼š
```cpp
#include "cpp_func.h"
#include <iostream>

void cpp_function(int x, double y) {
    std::cout << "C++ function called: " << x << ", " << y << std::endl;
}
```

**Cæºæ–‡ä»¶ï¼ˆmain.cï¼‰**ï¼š
```cpp
#include <stdio.h>
#include "cpp_func.h"  // Cä»£ç ç›´æ¥åŒ…å«C++å¤´æ–‡ä»¶

int main() {
    cpp_function(42, 3.14);  // Cä»£ç è°ƒç”¨C++å‡½æ•°
    return 0;
}
```

**ç¼–è¯‘ç»“æœ**ï¼š
```cpp
$ gcc -c main.c
$ g++ -c cpp_func.cpp
$ gcc -o main main.o cpp_func.o
main.o: In function `main':
main.c:(.text+0x19): undefined reference to `cpp_function'  // é“¾æ¥é”™è¯¯ï¼
collect2: error: ld returned 1 exit status
```

### 3.2 è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨extern "C"

**ä¿®æ”¹C++å¤´æ–‡ä»¶ï¼ˆcpp_func.hï¼‰**ï¼š
```cpp
// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼ŒåŒæ—¶æ”¯æŒCå’ŒC++è°ƒç”¨
#ifdef __cplusplus
extern "C" {
#endif

void cpp_function(int x, double y);

#ifdef __cplusplus
}
#endif
```

**ç¼–è¯‘ç»“æœ**ï¼š
```cpp
$ gcc -c main.c
$ g++ -c cpp_func.cpp
$ gcc -o main main.o cpp_func.o
$ ./main
C++ function called: 42, 3.14  // æˆåŠŸè¿è¡Œï¼
```

### 3.3 extern "C"çš„å·¥ä½œåŸç†

`extern "C"`æ˜¯C++çš„ä¸€ä¸ªé“¾æ¥è¯´æ˜ç¬¦ï¼Œç”¨äºå‘Šè¯‰C++ç¼–è¯‘å™¨ï¼š
1. ä¸è¦å¯¹è¢«ä¿®é¥°çš„å‡½æ•°è¿›è¡Œå‘½åä¿®é¥°
2. æŒ‰ç…§Cè¯­è¨€çš„è§„åˆ™ç”Ÿæˆå‡½æ•°å
3. ç¦ç”¨C++ç‰¹æœ‰çš„ç‰¹æ€§ï¼ˆå¦‚å‡½æ•°é‡è½½ï¼‰

## ğŸ“Œ 4. æ··åˆç¼–ç¨‹çš„æœ€ä½³å®è·µ

### 4.1 å¤´æ–‡ä»¶è®¾è®¡

- ä½¿ç”¨æ¡ä»¶ç¼–è¯‘åŒ…è£¹C++å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å£°æ˜
- åªåœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜æ¥å£ï¼Œä¸å®šä¹‰å®ç°
- æ¥å£å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼å°½é‡ä½¿ç”¨Cå…¼å®¹ç±»å‹

```cpp
// æœ€ä½³å®è·µï¼šC++å¤´æ–‡ä»¶è®¾è®¡
#ifdef __cplusplus
extern "C" {
#endif

// åªä½¿ç”¨Cå…¼å®¹ç±»å‹
int c_compatible_function(int arg1, const char* arg2, void* arg3);

#ifdef __cplusplus
}
#endif
```

### 4.2 æ¥å£è®¾è®¡åŸåˆ™

- é¿å…åœ¨æ¥å£ä¸­ä½¿ç”¨C++ç‰¹æœ‰çš„ç±»å‹ï¼ˆå¦‚ç±»ã€æ¨¡æ¿ã€å¼•ç”¨ç­‰ï¼‰
- é¿å…ä½¿ç”¨C++å¼‚å¸¸ï¼Œæ”¹ç”¨é”™è¯¯ç 
- å†…å­˜ç®¡ç†è¦ç»Ÿä¸€ï¼šCåˆ†é…çš„å†…å­˜ç”¨Cé‡Šæ”¾ï¼ŒC++åˆ†é…çš„å†…å­˜ç”¨C++é‡Šæ”¾

### 4.3 ç¼–è¯‘å’Œé“¾æ¥

- ä½¿ç”¨C++ç¼–è¯‘å™¨é“¾æ¥æœ€ç»ˆç¨‹åºï¼ˆæ¨èï¼‰
- æˆ–è€…ç¡®ä¿æ‰€æœ‰C++ä»£ç éƒ½ä½¿ç”¨extern "C"å£°æ˜
- ç¡®ä¿ä½¿ç”¨å…¼å®¹çš„ç¼–è¯‘é€‰é¡¹

### 4.4 å®Œæ•´ç¤ºä¾‹ï¼šCè°ƒç”¨C++ç±»

**C++å¤´æ–‡ä»¶ï¼ˆwrapper.hï¼‰**ï¼š
```cpp
#ifdef __cplusplus
class MyClass {
public:
    MyClass();
    ~MyClass();
    int do_something(int x);
private:
    int data;
};

extern "C" {
#endif

// Cæ¥å£
void* myclass_create();
int myclass_do_something(void* handle, int x);
void myclass_destroy(void* handle);

#ifdef __cplusplus
}
#endif
```

**C++æºæ–‡ä»¶ï¼ˆwrapper.cppï¼‰**ï¼š
```cpp
#include "wrapper.h"

MyClass::MyClass() : data(0) {}

MyClass::~MyClass() {}

int MyClass::do_something(int x) {
    data += x;
    return data;
}

// Cæ¥å£å®ç°
extern "C" {
void* myclass_create() {
    return new MyClass();
}

int myclass_do_something(void* handle, int x) {
    MyClass* obj = static_cast<MyClass*>(handle);
    return obj->do_something(x);
}

void myclass_destroy(void* handle) {
    MyClass* obj = static_cast<MyClass*>(handle);
    delete obj;
}
}
```

**Cæºæ–‡ä»¶ï¼ˆmain.cï¼‰**ï¼š
```cpp
#include <stdio.h>
#include "wrapper.h"

int main() {
    // ä½¿ç”¨Cæ¥å£åˆ›å»ºå’Œæ“ä½œC++å¯¹è±¡
    void* obj = myclass_create();
    int result1 = myclass_do_something(obj, 10);
    int result2 = myclass_do_something(obj, 20);
    
    printf("Result 1: %d\n", result1);
    printf("Result 2: %d\n", result2);
    
    myclass_destroy(obj);
    return 0;
}
```

**ç¼–è¯‘å’Œè¿è¡Œ**ï¼š
```cpp
$ g++ -c wrapper.cpp
$ gcc -c main.c
$ g++ -o main main.o wrapper.o
$ ./main
Result 1: 10
Result 2: 30
```

ğŸ“‹ **æ€»ç»“ä¸æœ€ä½³å®è·µ**

## ğŸ¯ 1. æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨extern "C"**æ˜¯è§£å†³Cä»£ç å¼•ç”¨C++ä»£ç çš„å…³é”®ï¼

- åœ¨C++å¤´æ–‡ä»¶ä¸­ï¼Œç”¨`extern "C"`åŒ…è£¹éœ€è¦è¢«Cè°ƒç”¨çš„å‡½æ•°å£°æ˜
- ç¡®ä¿C++æºæ–‡ä»¶ä¸­çš„å‡½æ•°å®šä¹‰ä¹Ÿå—åˆ°`extern "C"`çš„å½±å“
- ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼ˆ`#ifdef __cplusplus`ï¼‰ç¡®ä¿å¤´æ–‡ä»¶åŒæ—¶å…¼å®¹Cå’ŒC++

## ğŸ“Œ 2. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç±»å‹ | å¸¸è§é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ¡ˆ |
|----------|--------------|----------|
| é“¾æ¥é”™è¯¯ | undefined reference to `func' | ä½¿ç”¨extern "C"å£°æ˜C++å‡½æ•° |
| ç¼–è¯‘é”™è¯¯ | syntax error: identifier 'class' | ç¡®ä¿Cä»£ç ä¸ç›´æ¥åŒ…å«C++ç‰¹æœ‰çš„ç±»å‹å®šä¹‰ |
| ç¼–è¯‘é”™è¯¯ | conflicting types for 'bool' | é¿å…åœ¨Cä»£ç ä¸­ä½¿ç”¨C++å…³é”®å­— |
| è¿è¡Œæ—¶é”™è¯¯ | segmentation fault | ä¸è¦æ··ç”¨Cå’ŒC++çš„å†…å­˜ç®¡ç†å‡½æ•° |
| è¿è¡Œæ—¶é”™è¯¯ | abnormal program termination | ç¡®ä¿C++å‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸ |

## ğŸ“‹ 3. æœ€ä½³å®è·µæ€»ç»“

1. **ä½¿ç”¨extern "C"åŒ…è£¹C++æ¥å£**
2. **è®¾è®¡Cå…¼å®¹çš„æ¥å£**
3. **ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å…¼å®¹Cå’ŒC++**
4. **é¿å…æ··ç”¨å†…å­˜ç®¡ç†å‡½æ•°**
5. **ç¦ç”¨C++å¼‚å¸¸**
6. **ä½¿ç”¨C++ç¼–è¯‘å™¨é“¾æ¥æœ€ç»ˆç¨‹åº**
7. **ä¿æŒç¼–è¯‘é€‰é¡¹ä¸€è‡´**

## ğŸ“Œ 4. ä»€ä¹ˆæ—¶å€™éœ€è¦æ··åˆç¼–ç¨‹ï¼Ÿ

- é‡ç”¨ç°æœ‰çš„Cæˆ–C++åº“
- é€æ­¥å°†Cä»£ç è¿ç§»åˆ°C++
- åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼ŒC++ç”¨äºå¤æ‚é€»è¾‘ï¼ŒCç”¨äºåº•å±‚é©±åŠ¨
- ä¸å…¶ä»–è¯­è¨€ï¼ˆå¦‚Pythonã€Javaï¼‰äº¤äº’

é€šè¿‡ç†è§£Cå’ŒC++çš„ç¼–è¯‘å·®å¼‚ï¼Œå¹¶æ­£ç¡®ä½¿ç”¨extern "C"æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£å†³Cä»£ç å¼•ç”¨C++ä»£ç æ—¶çš„ç¼–è¯‘é”™è¯¯ï¼Œå®ç°æ— ç¼çš„æ··åˆç¼–ç¨‹ã€‚