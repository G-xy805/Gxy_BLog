---
title: 50.C++ Coroutine
order: 50
description: è¯¦è§£C++20åç¨‹ï¼ˆCoroutineï¼‰çš„æ¦‚å¿µã€åŸç†ã€å®ç°æœºåˆ¶å’Œä½¿ç”¨æ–¹æ³•
published: 2026-01-23
image: /assets/images/cpp-logo.webp
tags:
- C++20
- åç¨‹
- å¼‚æ­¥ç¼–ç¨‹
- å¹¶å‘
category: C++
---
# ğŸ”¬ C++ Coroutine
## ğŸ“‹ æ€»ç»“

ğŸ“– **å†…å®¹æ¦‚è§ˆ**
æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»C++20ä¸­å¼•å…¥çš„åç¨‹ï¼ˆCoroutineï¼‰ç‰¹æ€§ï¼ŒåŒ…æ‹¬åç¨‹çš„åŸºæœ¬æ¦‚å¿µã€æ ¸å¿ƒåŸç†ã€ç¼–è¯‘å™¨è½¬æ¢æœºåˆ¶ã€Promiseå’ŒAwaitableå¯¹è±¡çš„è®¾è®¡ï¼Œä»¥åŠåç¨‹åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­çš„åº”ç”¨ã€‚é€šè¿‡æ·±å…¥ç†è§£åç¨‹çš„å·¥ä½œåŸç†ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡è¿™ä¸€å¼ºå¤§çš„å¼‚æ­¥ç¼–ç¨‹å·¥å…·ã€‚
ğŸ“š **åç¨‹çš„åŸºæœ¬æ¦‚å¿µ**
### 1.1 ä»€ä¹ˆæ˜¯åç¨‹
åç¨‹ï¼ˆCoroutineï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥**æš‚åœæ‰§è¡Œ**å¹¶**åœ¨ç¨åæ¢å¤æ‰§è¡Œ**ï¼ŒåŒæ—¶**ä¿ç•™å…¶æ‰§è¡ŒçŠ¶æ€**ã€‚ä¸ä¼ ç»Ÿå‡½æ•°ä¸åŒï¼Œåç¨‹å¯ä»¥ï¼š
- åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœï¼Œå°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨è€…
- ä»æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œä¿ç•™ä¹‹å‰çš„å±€éƒ¨å˜é‡å’Œæ‰§è¡ŒçŠ¶æ€
- ä¸å…¶ä»–åç¨‹æˆ–çº¿ç¨‹åä½œæ‰§è¡Œ
### 1.2 C++åç¨‹çš„å…³é”®å­—
C++20å¼•å…¥äº†ä¸‰ä¸ªæ–°å…³é”®å­—æ¥æ”¯æŒåç¨‹ï¼š
| å…³é”®å­— | åŠŸèƒ½æè¿° |
|--------|----------|
| `co_await` | æš‚åœåç¨‹ï¼Œç­‰å¾…æŸä¸ªæ“ä½œå®Œæˆåæ¢å¤ |
| `co_return` | ä»åç¨‹è¿”å›ä¸€ä¸ªç»“æœå¹¶ç»“æŸåç¨‹ |
| `co_yield` | è¿”å›ä¸€ä¸ªç»“æœå¹¶æš‚åœåç¨‹ï¼Œå…è®¸åç»­æ¢å¤æ‰§è¡Œ |
### 1.3 åç¨‹çš„ç‰¹ç‚¹
- **è½»é‡çº§**ï¼šåç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€è¿œå°äºçº¿ç¨‹
- **åä½œå¼**ï¼šåç¨‹çš„æš‚åœå’Œæ¢å¤ç”±ç¨‹åºå‘˜æ˜¾å¼æ§åˆ¶
- **æ— æ ˆ**ï¼šC++åç¨‹æ˜¯æ— æ ˆåç¨‹ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªåç¨‹åˆ†é…ç‹¬ç«‹çš„æ ˆç©ºé—´
- **çŠ¶æ€ä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜å’Œæ¢å¤å±€éƒ¨å˜é‡å’Œæ‰§è¡ŒçŠ¶æ€
- **å¼‚æ­¥å‹å¥½**ï¼šéå¸¸é€‚åˆå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
ğŸ”§ **åç¨‹çš„ç¼–è¯‘è½¬æ¢**
å½“ç¼–è¯‘å™¨é‡åˆ°åŒ…å«åç¨‹å…³é”®å­—çš„å‡½æ•°æ—¶ï¼Œä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå¤æ‚çš„çŠ¶æ€æœºç»“æ„ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹æ˜¯ç†è§£åç¨‹å·¥ä½œåŸç†çš„å…³é”®ã€‚
### 2.1 åç¨‹å‡½æ•°çš„åŸºæœ¬å½¢å¼
ä¸€ä¸ªç®€å•çš„åç¨‹å‡½æ•°ç¤ºä¾‹ï¼š
```cpp
template <typename TRet, typename... TArgs>
TRet coro_func(TArgs... args) {
    // å‡½æ•°ä½“åŒ…å«è‡³å°‘ä¸€ä¸ªåç¨‹å…³é”®å­—
    co_return some_value;
}
```
### 2.2 ç¼–è¯‘å™¨çš„è½¬æ¢è¿‡ç¨‹
ç¼–è¯‘å™¨ä¼šå°†ä¸Šè¿°åç¨‹å‡½æ•°è½¬æ¢ä¸ºç±»ä¼¼ä»¥ä¸‹çš„å½¢å¼ï¼š

```cpp
// 1. ç¡®å®šPromiseç±»å‹
using promise_t = typename coroutine_traits<TRet, TArgs...>::promise_type;

// 2. åˆ›å»ºPromiseå¯¹è±¡
promise_t promise;
// 3. è·å–è¿”å›å¯¹è±¡
auto __return_obj__ = promise.get_return_object();
// 4. åˆå§‹æŒ‚èµ·
co_await promise.initial_suspend();
try {
    // 5. åç¨‹ä¸»ä½“
    // ç¼–è¯‘å™¨ä¼šå°†åŸå‡½æ•°ä½“è½¬æ¢ä¸ºçŠ¶æ€æœº
    // co_return expr; => promise.return_value(expr); goto final_suspend;
    // co_return;      => promise.return_void(); goto final_suspend;
    // co_yield expr;  => co_await promise.yield_value(expr);
} catch (...) {
    // 6. å¼‚å¸¸å¤„ç†
    promise.set_exception(std::current_exception());
}
final_suspend:
// 7. æœ€ç»ˆæŒ‚èµ·
co_await promise.final_suspend();
```
ğŸ¯ **åç¨‹çš„æ ¸å¿ƒç»„ä»¶**
### 3.1 Promiseç±»å‹
Promiseæ˜¯åç¨‹çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ï¼š
- åˆ›å»ºåç¨‹çš„è¿”å›å¯¹è±¡
- å¤„ç†åç¨‹çš„è¿”å›å€¼ï¼ˆé€šè¿‡`return_value`æˆ–`return_void`ï¼‰
- å¤„ç†åç¨‹äº§ç”Ÿçš„å€¼ï¼ˆé€šè¿‡`yield_value`ï¼‰
- å¤„ç†åç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆé€šè¿‡`set_exception`ï¼‰
- æ§åˆ¶åç¨‹çš„åˆå§‹å’Œæœ€ç»ˆæŒ‚èµ·è¡Œä¸º
Promiseç±»å‹å¿…é¡»å®ç°ä»¥ä¸‹æ¥å£ï¼ˆéƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼‰ï¼š
| æ–¹æ³• | å¿…é¡»å®ç°ï¼Ÿ | åŠŸèƒ½æè¿° |
|------|-----------|----------|
| `get_return_object()` | æ˜¯ | è¿”å›åç¨‹çš„ç»“æœå¯¹è±¡ |
| `initial_suspend()` | æ˜¯ | æ§åˆ¶åç¨‹æ˜¯å¦åœ¨å¼€å§‹æ—¶æŒ‚èµ· |
| `final_suspend() noexcept` | æ˜¯ | æ§åˆ¶åç¨‹åœ¨ç»“æŸæ—¶çš„æŒ‚èµ·è¡Œä¸º |
| `return_value(T)` | æ˜¯ï¼ˆæœ‰è¿”å›å€¼æ—¶ï¼‰ | å¤„ç†åç¨‹çš„è¿”å›å€¼ |
| `return_void()` | æ˜¯ï¼ˆæ— è¿”å›å€¼æ—¶ï¼‰ | å¤„ç†åç¨‹çš„æ— è¿”å›å€¼æƒ…å†µ |
| `yield_value(T)` | å¦ï¼ˆç”Ÿæˆå€¼æ—¶ï¼‰ | å¤„ç†åç¨‹äº§ç”Ÿçš„å€¼ |
| `set_exception(std::exception_ptr)` | å¦ | å¤„ç†åç¨‹æŠ›å‡ºçš„å¼‚å¸¸ |
### 3.2 Awaitableå¯¹è±¡
Awaitableå¯¹è±¡æ˜¯å¯ä»¥è¢«`co_await`ç­‰å¾…çš„å¯¹è±¡ï¼Œå¿…é¡»å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š
| æ–¹æ³• | åŠŸèƒ½æè¿° |
|------|----------|
| `await_ready()` | æ£€æŸ¥æ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œè¿”å›`true`åˆ™è·³è¿‡æŒ‚èµ· |
| `await_suspend(coroutine_handle<>)` | æŒ‚èµ·åç¨‹ï¼Œè¿”å›å€¼æ§åˆ¶åç»­è¡Œä¸º |
| `await_resume()` | æ¢å¤åç¨‹æ—¶è¿”å›ç»“æœ |
### 3.3 coroutine_handle
`std::coroutine_handle<>`æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¥æŸ„ï¼Œç”¨äºæ§åˆ¶åç¨‹çš„æ‰§è¡Œï¼š
- `resume()`ï¼šæ¢å¤åç¨‹æ‰§è¡Œ
- `destroy()`ï¼šé”€æ¯åç¨‹
- `done()`ï¼šæ£€æŸ¥åç¨‹æ˜¯å¦å·²å®Œæˆ
- `promise()`ï¼šè·å–åç¨‹å…³è”çš„Promiseå¯¹è±¡
ğŸ’» **åç¨‹çš„å®ç°ç¤ºä¾‹**
### 4.1 ç®€å•çš„ç”Ÿæˆå™¨ç¤ºä¾‹
ä¸‹é¢å®ç°ä¸€ä¸ªç®€å•çš„æ•´æ•°ç”Ÿæˆå™¨ï¼Œä½¿ç”¨åç¨‹ç”Ÿæˆä»1åˆ°nçš„æ•´æ•°ï¼š

```cpp
#include <iostream>
#include <coroutine>

// ç”Ÿæˆå™¨çš„è¿”å›ç±»å‹
template <typename T>
struct Generator {
    // Promiseç±»å‹
    struct promise_type {
        T value;
        std::exception_ptr exception;
        
        Generator get_return_object() {
            return Generator{std::coroutine_handle<promise_type>::from_promise(*this)};
        }
        
        std::suspend_always initial_suspend() noexcept {
            return {};
        }
        
        std::suspend_always final_suspend() noexcept {
            return {};
        }
        
        void unhandled_exception() noexcept {
            exception = std::current_exception();
        }
        
        template <std::convertible_to<T> From>
        std::suspend_always yield_value(From&& from) noexcept {
            value = std::forward<From>(from);
            return {};
        }
        
        void return_void() noexcept {
        }
    };
    
    std::coroutine_handle<promise_type> handle;
    
    explicit Generator(std::coroutine_handle<promise_type> h) : handle(h) {}
    
    ~Generator() {
        if (handle) handle.destroy();
    }
    
    Generator(const Generator&) = delete;
    Generator& operator=(const Generator&) = delete;
    
    Generator(Generator&& other) noexcept : handle(other.handle) {
        other.handle = nullptr;
    }
    
    Generator& operator=(Generator&& other) noexcept {
        if (this != &other) {
            if (handle) handle.destroy();
            handle = other.handle;
            other.handle = nullptr;
        }
        return *this;
    }
    
    // è¿­ä»£å™¨æ”¯æŒ
    struct iterator {
        std::coroutine_handle<promise_type> handle;
        bool done;
        
        iterator(std::coroutine_handle<promise_type> h, bool d) : handle(h), done(d) {}
        
        iterator& operator++() {
            handle.resume();
            done = handle.done();
            return *this;
        }
        
        T operator*() const {
            return handle.promise().value;
        }
        
        bool operator!=(const iterator& other) const {
            return done != other.done;
        }
    };
    
    iterator begin() {
        handle.resume();
        return {handle, handle.done()};
    }
    
    iterator end() {
        return {handle, true};
    }
};

// åç¨‹å‡½æ•°ï¼šç”Ÿæˆä»1åˆ°nçš„æ•´æ•°
Generator<int> generate_range(int n) {
    for (int i = 1; i <= n; ++i) {
        co_yield i;
    }
}

int main() {
    // ä½¿ç”¨ç”Ÿæˆå™¨
    for (int i : generate_range(5)) {
        std::cout << i << " ";
    }
    // è¾“å‡º: 1 2 3 4 5
    
    return 0;
}
```
### 4.2 å¼‚æ­¥ä»»åŠ¡ç¤ºä¾‹
ä¸‹é¢å®ç°ä¸€ä¸ªç®€å•çš„å¼‚æ­¥ä»»åŠ¡ï¼Œæ¼”ç¤ºåç¨‹åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­çš„åº”ç”¨ï¼š

```cpp
#include <iostream>
#include <future>
#include <thread>
#include <coroutine>
#include <chrono>

// å¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç±»å‹
struct AsyncTask {
    struct promise_type {
        std::promise<int> result_promise;
        
        AsyncTask get_return_object() {
            return AsyncTask{std::coroutine_handle<promise_type>::from_promise(*this)};
        }
        
        std::suspend_never initial_suspend() noexcept {
            return {};
        }
        
        std::suspend_never final_suspend() noexcept {
            return {};
        }
        
        void unhandled_exception() noexcept {
            result_promise.set_exception(std::current_exception());
        }
        
        void return_value(int value) noexcept {
            result_promise.set_value(value);
        }
    };
    
    std::coroutine_handle<promise_type> handle;
    
    explicit AsyncTask(std::coroutine_handle<promise_type> h) : handle(h) {}
    
    ~AsyncTask() {
        if (handle) handle.destroy();
    }
    
    // è·å–å¼‚æ­¥ç»“æœ
    std::future<int> get_future() {
        return handle.promise().result_promise.get_future();
    }
};

// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
void sleep_ms(int ms) {
    std::this_thread::sleep_for(std::chrono::milliseconds(ms));
}

// å¼‚æ­¥ä»»åŠ¡åç¨‹
AsyncTask async_operation(int value, int delay_ms) {
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    sleep_ms(delay_ms);
    co_return value * 2;
}

int main() {
    // åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
    AsyncTask task = async_operation(42, 1000);
    
    // è·å–future
    std::future<int> future = task.get_future();
    
    std::cout << "ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆ..." << std::endl;
    
    // ç­‰å¾…ç»“æœ
    int result = future.get();
    
    std::cout << "å¼‚æ­¥ä»»åŠ¡ç»“æœ: " << result << std::endl;
    // è¾“å‡º: å¼‚æ­¥ä»»åŠ¡ç»“æœ: 84
    
    return 0;
}
```
ğŸš€ **åç¨‹çš„é«˜çº§ç‰¹æ€§**
### 5.1 åç¨‹çš„çŠ¶æ€ç®¡ç†
åç¨‹çš„çŠ¶æ€ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç®¡ç†ï¼ŒåŒ…æ‹¬ï¼š
- å±€éƒ¨å˜é‡çš„ä¿å­˜å’Œæ¢å¤
- æ‰§è¡Œä½ç½®çš„è·Ÿè¸ª
- å¼‚å¸¸çš„ä¼ æ’­å’Œå¤„ç†
### 5.2 åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ç­–ç•¥
åç¨‹çš„æŒ‚èµ·è¡Œä¸ºç”±Promiseç±»å‹çš„`initial_suspend()`å’Œ`final_suspend()`æ–¹æ³•æ§åˆ¶ï¼š
- `std::suspend_always`ï¼šæ€»æ˜¯æŒ‚èµ·
- `std::suspend_never`ï¼šä»ä¸æŒ‚èµ·
### 5.3 åç¨‹çš„å¼‚å¸¸å¤„ç†
åç¨‹ä¸­çš„å¼‚å¸¸ä¼šè¢«æ•è·å¹¶é€šè¿‡Promiseçš„`set_exception()`æ–¹æ³•ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚
ğŸ› ï¸ **åç¨‹çš„åº”ç”¨åœºæ™¯**
### 6.1 å¼‚æ­¥ç¼–ç¨‹
åç¨‹éå¸¸é€‚åˆå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œå¦‚ï¼š
- ç½‘ç»œI/Oæ“ä½œ
- æ–‡ä»¶I/Oæ“ä½œ
- å¼‚æ­¥äº‹ä»¶å¤„ç†
- å¹¶å‘ä»»åŠ¡è°ƒåº¦
### 6.2 ç”Ÿæˆå™¨æ¨¡å¼
ç”¨äºç”Ÿæˆåºåˆ—å€¼ï¼Œå¦‚ï¼š
- æ— é™åºåˆ—ç”Ÿæˆ
- æƒ°æ€§è®¡ç®—
- æ•°æ®æµå¤„ç†
### 6.3 çŠ¶æ€æœºå®ç°
åç¨‹å¯ä»¥ç®€åŒ–å¤æ‚çŠ¶æ€æœºçš„å®ç°ï¼Œå¦‚ï¼š
- è§£æå™¨ï¼ˆå¦‚JSONè§£æå™¨ï¼‰
- æ¸¸æˆAI
- å·¥ä½œæµå¼•æ“
### 6.4 å¹¶å‘æ§åˆ¶
ç”¨äºå®ç°é«˜æ•ˆçš„å¹¶å‘æ§åˆ¶ï¼Œå¦‚ï¼š
- è½»é‡çº§çº¿ç¨‹æ± 
- ä»»åŠ¡è°ƒåº¦å™¨
- åä½œå¼å¤šä»»åŠ¡
âš–ï¸ **åç¨‹çš„ä¼˜ç¼ºç‚¹**
### 7.1 ä¼˜ç‚¹
1. **é«˜æ€§èƒ½**ï¼šåç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€è¿œå°äºçº¿ç¨‹
2. **ç®€åŒ–å¼‚æ­¥ä»£ç **ï¼šå°†å¼‚æ­¥ä»£ç å†™å¾—åƒåŒæ­¥ä»£ç ä¸€æ ·æ¸…æ™°
3. **æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡**ï¼šå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€
4. **æ›´çµæ´»çš„æ§åˆ¶æµ**ï¼šå…è®¸å¤æ‚çš„æ§åˆ¶æµæ¨¡å¼
5. **æ›´å¥½çš„å¯ç»„åˆæ€§**ï¼šä¾¿äºæ„å»ºå¤æ‚çš„å¼‚æ­¥æ“ä½œé“¾
### 7.2 ç¼ºç‚¹
1. **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼šåç¨‹çš„æ¦‚å¿µå’Œå®ç°ç›¸å¯¹å¤æ‚
2. **ç¼–è¯‘å™¨æ”¯æŒè¦æ±‚é«˜**ï¼šéœ€è¦C++20æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¼–è¯‘å™¨
3. **è°ƒè¯•å›°éš¾**ï¼šåç¨‹çš„çŠ¶æ€æœºè½¬æ¢ä½¿å¾—è°ƒè¯•å˜å¾—å¤æ‚
4. **å†…å­˜ç®¡ç†å¤æ‚**ï¼šéœ€è¦æ­£ç¡®ç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
5. **æ ‡å‡†åº“æ”¯æŒæœ‰é™**ï¼šC++20æ ‡å‡†åº“å¯¹åç¨‹çš„æ”¯æŒç›¸å¯¹åŸºç¡€
ğŸŒŸ **åç¨‹çš„æœ€ä½³å®è·µ**
### 8.1 è®¾è®¡è‰¯å¥½çš„Promiseå’Œè¿”å›ç±»å‹
- ç¡®ä¿Promiseç±»å‹å®ç°äº†æ‰€æœ‰å¿…è¦çš„æ¥å£
- è®¾è®¡ç›´è§‚æ˜“ç”¨çš„è¿”å›ç±»å‹
- è€ƒè™‘å¼‚å¸¸å®‰å…¨
### 8.2 åˆç†ä½¿ç”¨åç¨‹å…³é”®å­—
- æ˜ç¡®åŒºåˆ†`co_await`ã€`co_return`å’Œ`co_yield`çš„ä½¿ç”¨åœºæ™¯
- é¿å…è¿‡åº¦ä½¿ç”¨åç¨‹ï¼Œç®€å•æƒ…å†µä½¿ç”¨ä¼ ç»Ÿå‡½æ•°æ›´åˆé€‚
### 8.3 æ³¨æ„åç¨‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ç¡®ä¿åç¨‹æœ€ç»ˆè¢«æ­£ç¡®é”€æ¯
- é¿å…æ‚¬å‚çš„`coroutine_handle`
### 8.4 ç»“åˆå…¶ä»–å¼‚æ­¥æœºåˆ¶ä½¿ç”¨
- ä¸`std::future`å’Œ`std::async`ç»“åˆä½¿ç”¨
- ä¸çº¿ç¨‹æ± å’Œäº‹ä»¶å¾ªç¯ç»“åˆä½¿ç”¨
### 8.5 è€ƒè™‘æ€§èƒ½å½±å“
- é¿å…åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸Šé¢‘ç¹åˆ›å»ºå’Œé”€æ¯åç¨‹
- åˆç†è®¾è®¡åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ç­–ç•¥
ğŸ“‹ **æ€»ç»“**
### 9.1 åç¨‹çš„æ ¸å¿ƒè¦ç‚¹
1. **åç¨‹æ˜¯ç‰¹æ®Šå‡½æ•°**ï¼šå¯ä»¥æš‚åœå’Œæ¢å¤æ‰§è¡Œï¼Œä¿ç•™æ‰§è¡ŒçŠ¶æ€
2. **ä¸‰ä¸ªå…³é”®å­—**ï¼š`co_await`ã€`co_return`ã€`co_yield`
3. **ç¼–è¯‘å™¨è½¬æ¢**ï¼šåç¨‹è¢«è½¬æ¢ä¸ºå¤æ‚çš„çŠ¶æ€æœºç»“æ„
4. **Promiseå’ŒAwaitable**ï¼šåç¨‹çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ§åˆ¶åç¨‹çš„è¡Œä¸º
5. **è½»é‡çº§**ï¼šåˆ›å»ºå’Œåˆ‡æ¢å¼€é”€è¿œå°äºçº¿ç¨‹
6. **å¼‚æ­¥å‹å¥½**ï¼šç®€åŒ–å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
### 9.2 åç¨‹çš„å‘å±•å‰æ™¯
C++20åç¨‹æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå°½ç®¡ç›®å‰æ ‡å‡†åº“æ”¯æŒæœ‰é™ï¼Œä½†å·²ç»æœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº“æä¾›äº†æ›´é«˜çº§çš„åç¨‹æ”¯æŒï¼Œå¦‚ï¼š
- `cppcoro`ï¼šæä¾›äº†ä¸°å¯Œçš„åç¨‹å·¥å…·å’Œç»„ä»¶
- `libunifex`ï¼šå®éªŒæ€§çš„C++ç»Ÿä¸€æ‰§è¡Œæ¨¡å‹
- `boost.coroutine2`ï¼šBooståº“çš„åç¨‹å®ç°
éšç€C++æ ‡å‡†çš„ä¸æ–­å‘å±•ï¼Œåç¨‹åœ¨C++ç”Ÿæ€ç³»ç»Ÿä¸­çš„åº”ç”¨å°†è¶Šæ¥è¶Šå¹¿æ³›ï¼Œæˆä¸ºå¼‚æ­¥ç¼–ç¨‹å’Œå¹¶å‘æ§åˆ¶çš„é‡è¦å·¥å…·ã€‚
### 9.3 å­¦ä¹ å»ºè®®
1. **ä»ç®€å•ç¤ºä¾‹å¼€å§‹**ï¼šå…ˆç†è§£åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•
2. **æ·±å…¥å­¦ä¹ å®ç°åŸç†**ï¼šäº†è§£ç¼–è¯‘å™¨å¦‚ä½•è½¬æ¢åç¨‹
3. **ç ”ç©¶ä¼˜ç§€å®è·µ**ï¼šå­¦ä¹ æˆç†Ÿåº“çš„è®¾è®¡æ¨¡å¼
4. **å®é™…é¡¹ç›®åº”ç”¨**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­å°è¯•ä½¿ç”¨åç¨‹
5. **å…³æ³¨æ ‡å‡†å‘å±•**ï¼šè·Ÿè¸ªC++æ ‡å‡†å¯¹åç¨‹çš„æ‰©å±•å’Œæ”¹è¿›
é€šè¿‡æ·±å…¥å­¦ä¹ å’Œå®è·µï¼Œå¼€å‘è€…å¯ä»¥æŒæ¡åç¨‹è¿™ä¸€å¼ºå¤§å·¥å…·ï¼Œç¼–å†™æ›´é«˜æ•ˆã€æ›´æ¸…æ™°çš„å¼‚æ­¥å’Œå¹¶å‘ä»£ç ã€‚