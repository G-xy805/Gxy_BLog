---
title: 41.moveå‡½æ•°
order: 41
description: è¯¦è§£C++ç§»åŠ¨è¯­ä¹‰å’Œstd::moveå‡½æ•°çš„åŸç†åŠä½¿ç”¨
published: '2026-01-23'
image: /assets/images/cpp-logo.webp
tags:
- C++
- ç§»åŠ¨è¯­ä¹‰
- å³å€¼å¼•ç”¨
- å†…å­˜ä¼˜åŒ–
- C++11
category: C++
---
# ğŸ”¬ moveå‡½æ•°
## ğŸ“– å†…å®¹æ¦‚è§ˆ

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

## ğŸ”„ åŠŸèƒ½è¯¦è§£

## âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ æ³¨æ„äº‹é¡¹

## ğŸ’¡ å…³é”®è¦ç‚¹

## ğŸ“‹ æ€»ç»“


ğŸ“– å†…å®¹æ¦‚è§ˆ

æœ¬æ–‡è¯¦ç»†ä»‹ç»C++ä¸­çš„ç§»åŠ¨è¯­ä¹‰å’Œstd::moveå‡½æ•°ï¼ŒåŒ…æ‹¬å€¼ç±»å‹ï¼ˆå·¦å€¼å’Œå³å€¼ï¼‰çš„åŸºæœ¬æ¦‚å¿µã€ç§»åŠ¨è¯­ä¹‰çš„åŸç†ã€std::moveå‡½æ•°çš„å®ç°æœºåˆ¶ä»¥åŠå®é™…ä½¿ç”¨åœºæ™¯ã€‚é€šè¿‡ä¸°å¯Œçš„ä»£ç ç¤ºä¾‹å’Œæ·±å…¥çš„åŸç†åˆ†æï¼Œå¸®åŠ©è¯»è€…ç†è§£ç§»åŠ¨è¯­ä¹‰å¦‚ä½•æé«˜ç¨‹åºæ€§èƒ½ï¼Œä»¥åŠstd::moveå‡½æ•°åœ¨å…¶ä¸­çš„ä½œç”¨ã€‚

ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

## ğŸ“Œ 1. å€¼ç±»å‹ï¼ˆValue Categoryï¼‰

C++ä¸­çš„è¡¨è¾¾å¼å¯ä»¥åˆ†ä¸ºä¸åŒçš„å€¼ç±»å‹ï¼Œå¸¸ç”¨çš„ä¸»è¦æ˜¯å·¦å€¼å’Œå³å€¼ï¼š

### 1.1 å·¦å€¼ä¸å³å€¼çš„åŸºæœ¬å®šä¹‰

- **å·¦å€¼ï¼ˆLvalueï¼‰**ï¼šå¯ä»¥å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦å·¦ä¾§çš„å€¼ï¼Œä»£è¡¨ä¸€ä¸ªæŒä¹…çš„å†…å­˜ä½ç½®
- **å³å€¼ï¼ˆRvalueï¼‰**ï¼šåªèƒ½å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦å³ä¾§çš„å€¼ï¼Œä»£è¡¨ä¸´æ—¶å¯¹è±¡æˆ–å­—é¢é‡

### 1.2 å·¦å€¼ä¸å³å€¼çš„åˆ¤æ–­æ–¹æ³•

| ç±»å‹ | ç‰¹ç‚¹ | ç¤ºä¾‹ |
|------|------|------|
| å·¦å€¼ | æœ‰æŒä¹…å†…å­˜åœ°å€ï¼Œå¯è¢«å–åœ°å€ | å˜é‡åã€æ•°ç»„å…ƒç´ ã€è¿”å›å·¦å€¼å¼•ç”¨çš„å‡½æ•°è°ƒç”¨ |
| å³å€¼ | ä¸´æ—¶å¯¹è±¡ï¼Œä¸å¯è¢«å–åœ°å€ | å­—é¢é‡ï¼ˆ10, "hello"ï¼‰ã€ä¸´æ—¶å¯¹è±¡ã€è¿”å›éå¼•ç”¨çš„å‡½æ•°è°ƒç”¨ |

### 1.3 ç‰¹æ®Šæƒ…å†µ

- ä¸´æ—¶å˜é‡ï¼ˆå¦‚`std::string()`ï¼‰éƒ½æ˜¯å³å€¼
- å‡½æ•°å½¢å‚æ°¸è¿œæ˜¯å·¦å€¼ï¼Œå³ä½¿æ˜¯å³å€¼å¼•ç”¨ç±»å‹
- å³å€¼å¼•ç”¨æœ¬èº«æ˜¯å·¦å€¼

## ğŸ“Œ 2. ç§»åŠ¨è¯­ä¹‰

### 2.1 ç§»åŠ¨è¯­ä¹‰çš„æ¦‚å¿µ

ç§»åŠ¨è¯­ä¹‰æ˜¯C++11å¼•å…¥çš„ç‰¹æ€§ï¼Œå…è®¸å°†èµ„æºï¼ˆå¦‚å†…å­˜ï¼‰ä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸éœ€è¦è¿›è¡Œæ˜‚è´µçš„æ·±æ‹·è´æ“ä½œã€‚

### 2.2 ç§»åŠ¨è¯­ä¹‰ vs å¤åˆ¶è¯­ä¹‰

| ç‰¹æ€§ | å¤åˆ¶è¯­ä¹‰ | ç§»åŠ¨è¯­ä¹‰ |
|------|----------|----------|
| èµ„æºå¤„ç† | æ·±æ‹·è´ï¼Œåˆ›å»ºæ–°èµ„æº | è½¬ç§»èµ„æºæ‰€æœ‰æƒï¼Œä¸åˆ›å»ºæ–°èµ„æº |
| æ€§èƒ½ | è¾ƒä½ï¼Œæ¶‰åŠå¤§é‡å†…å­˜æ“ä½œ | è¾ƒé«˜ï¼Œä»…ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘ |
| åŸå¯¹è±¡çŠ¶æ€ | ä¿æŒä¸å˜ | èµ„æºè¢«è½¬ç§»ï¼Œå¤„äºæœ‰æ•ˆä½†æœªå®šä¹‰çŠ¶æ€ |

### 2.3 ç§»åŠ¨è¯­ä¹‰çš„å®ç°

ç§»åŠ¨è¯­ä¹‰é€šè¿‡**ç§»åŠ¨æ„é€ å‡½æ•°**å’Œ**ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦**å®ç°ï¼š

```cpp
class MyClass {
public:
    // ç§»åŠ¨æ„é€ å‡½æ•°
    MyClass(MyClass&& other) noexcept {
        // è½¬ç§»èµ„æºæ‰€æœ‰æƒ
        this->resource = other.resource;
        other.resource = nullptr;  // åŸå¯¹è±¡èµ„æºæŒ‡é’ˆç½®ç©º
    }
    
    // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦
    MyClass& operator=(MyClass&& other) noexcept {
        if (this != &other) {
            delete resource;  // é‡Šæ”¾å½“å‰èµ„æº
            resource = other.resource;  // è½¬ç§»èµ„æº
            other.resource = nullptr;  // åŸå¯¹è±¡èµ„æºæŒ‡é’ˆç½®ç©º
        }
        return *this;
    }
    
private:
    Resource* resource;
};
```

## ğŸ“Œ 3. std::moveå‡½æ•°

### 3.1 std::moveçš„æ ¸å¿ƒä½œç”¨

**std::moveå¹¶ä¸ä¼šè¿›è¡Œä»»ä½•å®é™…çš„ç§»åŠ¨æ“ä½œ**ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œè§¦å‘ç§»åŠ¨è¯­ä¹‰ã€‚

### 3.2 std::moveçš„å®ç°åŸç†

```cpp
// std::moveçš„ç®€åŒ–å®ç°
template <class T>
constexpr std::remove_reference_t<T>&& move(T&& arg) noexcept {
    // ç§»é™¤ç±»å‹çš„å¼•ç”¨å±æ€§ï¼Œç„¶åè½¬æ¢ä¸ºå³å€¼å¼•ç”¨
    return static_cast<std::remove_reference_t<T>&&>(arg);
}
```

### 3.3 std::moveçš„å·¥ä½œæœºåˆ¶

1. **æ¨¡æ¿æ¨å¯¼**ï¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¨å¯¼æ¨¡æ¿å‚æ•°T
2. **ç§»é™¤å¼•ç”¨**ï¼šä½¿ç”¨`std::remove_reference_t`ç§»é™¤ç±»å‹çš„å¼•ç”¨å±æ€§
3. **å¼ºåˆ¶è½¬æ¢**ï¼šå°†å‚æ•°å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ç±»å‹
4. **è¿è¡Œæ—¶æ— æ“ä½œ**ï¼šstd::moveåœ¨è¿è¡Œæ—¶ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œ

ğŸ’» ä»£ç ç¤ºä¾‹

### 1. å·¦å€¼ä¸å³å€¼çš„åŸºæœ¬ç¤ºä¾‹

```cpp
#include <iostream>
#include <string>

int main() {
    // å·¦å€¼ç¤ºä¾‹
    std::string left_value = "hello";
    std::string& lref = left_value;  // å·¦å€¼å¼•ç”¨
    
    // å³å€¼ç¤ºä¾‹
    std::string&& rref = "world";  // å³å€¼å¼•ç”¨ï¼Œç»‘å®šåˆ°ä¸´æ—¶å¯¹è±¡
    std::string&& rref2 = std::string("temp");  // å³å€¼å¼•ç”¨ï¼Œç»‘å®šåˆ°ä¸´æ—¶å¯¹è±¡
    
    // å‡½æ•°è¿”å›å€¼æ˜¯å³å€¼
    auto get_string = []() { return std::string("returned"); };
    std::string&& rref3 = get_string();  
    
    std::cout << "left_value: " << left_value << std::endl;
    std::cout << "lref: " << lref << std::endl;
    std::cout << "rref: " << rref << std::endl;
    
    return 0;
}
```

### 2. std::moveçš„åŸºæœ¬ä½¿ç”¨

```cpp
#include <vector>
#include <iostream>

class Vector {
private:
    int x, y, z;
public:
    Vector(int x, int y, int z) : x(x), y(y), z(z) {
        std::cout << "Constructor called" << std::endl;
    }
    
    // æ‹·è´æ„é€ å‡½æ•°
    Vector(const Vector& other) : x(other.x), y(other.y), z(other.z) {
        std::cout << "Copy constructor called" << std::endl;
    }
    
    // ç§»åŠ¨æ„é€ å‡½æ•°
    Vector(Vector&& other) noexcept : x(other.x), y(other.y), z(other.z) {
        std::cout << "Move constructor called" << std::endl;
    }
};

int main() {
    std::vector<Vector> vec;
    
    std::cout << "=== Push back temporary object (rvalue) ===" << std::endl;
    vec.push_back(Vector(1, 2, 3));  // è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°
    
    std::cout << "\n=== Push back lvalue ===" << std::endl;
    Vector a(4, 5, 6);
    vec.push_back(a);  // è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°
    
    std::cout << "\n=== Push back with std::move ===" << std::endl;
    vec.push_back(std::move(a));  // è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°
    
    return 0;
}
```

### 3. std::moveåœ¨å®é™…åœºæ™¯ä¸­çš„åº”ç”¨

```cpp
#include <iostream>
#include <string>
#include <utility>

class StringWrapper {
private:
    char* data;
    size_t length;
    
public:
    // æ„é€ å‡½æ•°
    StringWrapper(const char* str) {
        length = strlen(str);
        data = new char[length + 1];
        strcpy(data, str);
        std::cout << "Constructor: Allocated " << length + 1 << " bytes" << std::endl;
    }
    
    // ææ„å‡½æ•°
    ~StringWrapper() {
        if (data) {
            delete[] data;
            std::cout << "Destructor: Freed memory" << std::endl;
        }
    }
    
    // æ‹·è´æ„é€ å‡½æ•°ï¼ˆæ·±æ‹·è´ï¼‰
    StringWrapper(const StringWrapper& other) {
        length = other.length;
        data = new char[length + 1];
        strcpy(data, other.data);
        std::cout << "Copy Constructor: Deep copied " << length + 1 << " bytes" << std::endl;
    }
    
    // ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆèµ„æºè½¬ç§»ï¼‰
    StringWrapper(StringWrapper&& other) noexcept : data(other.data), length(other.length) {
        other.data = nullptr;  // åŸå¯¹è±¡èµ„æºæŒ‡é’ˆç½®ç©º
        other.length = 0;
        std::cout << "Move Constructor: Transferred ownership" << std::endl;
    }
    
    // è·å–å­—ç¬¦ä¸²å†…å®¹
    const char* get() const { return data; }
};

int main() {
    std::cout << "=== Create original object ===" << std::endl;
    StringWrapper original("Hello, Move Semantics!");
    
    std::cout << "\n=== Copy construct (expensive) ===" << std::endl;
    StringWrapper copy = original;  // æ·±æ‹·è´ï¼Œæ˜‚è´µæ“ä½œ
    
    std::cout << "\n=== Move construct (cheap) ===" << std::endl;
    StringWrapper moved = std::move(original);  // èµ„æºè½¬ç§»ï¼Œå»‰ä»·æ“ä½œ
    
    std::cout << "\n=== Original object after move ===" << std::endl;
    std::cout << "Original data: " << (original.get() ? original.get() : "nullptr") << std::endl;
    std::cout << "Moved data: " << moved.get() << std::endl;
    
    return 0;
}
```

âš ï¸ æ³¨æ„äº‹é¡¹

1. **std::moveæœ¬èº«ä¸ç§»åŠ¨**ï¼šå®ƒåªæ˜¯å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼ŒçœŸæ­£çš„ç§»åŠ¨ç”±ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦æ‰§è¡Œ
2. **åŸå¯¹è±¡çŠ¶æ€**ï¼šä½¿ç”¨std::moveåï¼ŒåŸå¯¹è±¡çš„èµ„æºè¢«è½¬ç§»ï¼Œå¤„äºæœ‰æ•ˆä½†æœªå®šä¹‰çš„çŠ¶æ€ï¼Œä¸åº”å†ä½¿ç”¨å…¶èµ„æº
3. **å³å€¼å¼•ç”¨æ˜¯å·¦å€¼**ï¼šå³å€¼å¼•ç”¨æœ¬èº«æ˜¯å·¦å€¼ï¼Œéœ€è¦å†æ¬¡ä½¿ç”¨std::moveæ‰èƒ½ç»§ç»­è½¬ç§»èµ„æº
4. **noexceptçš„é‡è¦æ€§**ï¼šç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦åº”æ ‡è®°ä¸ºnoexceptï¼Œå¦åˆ™æŸäº›å®¹å™¨ï¼ˆå¦‚vectorï¼‰å¯èƒ½ä¸ä¼šä½¿ç”¨å®ƒä»¬
5. **æ¨¡æ¿ä¸­çš„å³å€¼å¼•ç”¨**ï¼šåœ¨æ¨¡æ¿ä¸­ï¼Œ`T&&`æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼Œä¸æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¨å¯¼å‡ºä¸åŒç±»å‹

ğŸ“š æ€»ç»“ä¸æœ€ä½³å®è·µ

### 1. std::moveçš„æ ¸å¿ƒè¦ç‚¹

- **ä½œç”¨**ï¼šå°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œè§¦å‘ç§»åŠ¨è¯­ä¹‰
- **æ€§èƒ½**ï¼šå‡å°‘ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œæé«˜ç¨‹åºæ€§èƒ½
- **å®ç°**ï¼šä»…åŒ…å«ç±»å‹è½¬æ¢ï¼Œè¿è¡Œæ—¶æ— å¼€é”€
- **åŸå¯¹è±¡**ï¼šç§»åŠ¨ååŸå¯¹è±¡èµ„æºè¢«è½¬ç§»ï¼Œåº”é¿å…ä½¿ç”¨

### 2. ç§»åŠ¨è¯­ä¹‰çš„ä½¿ç”¨åœºæ™¯

- **STLå®¹å™¨æ“ä½œ**ï¼šå¦‚`push_back`ã€`emplace_back`ç­‰ï¼Œé¿å…ä¸å¿…è¦çš„æ‹·è´
- **å‡½æ•°è¿”å›å€¼ä¼˜åŒ–**ï¼šå…è®¸è¿”å›å¤§å‹å¯¹è±¡è€Œä¸äº§ç”Ÿæ‹·è´å¼€é”€
- **èµ„æºç®¡ç†**ï¼šè½¬ç§»åŠ¨æ€åˆ†é…çš„èµ„æºæ‰€æœ‰æƒï¼Œé¿å…å†…å­˜æ³„æ¼
- **æ€§èƒ½å…³é”®è·¯å¾„**ï¼šåœ¨æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯ä¸­å‡å°‘å†…å­˜æ“ä½œ

### 3. æœ€ä½³å®è·µ

1. **ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°ç§»åŠ¨è¯­ä¹‰**ï¼šå½“ç±»ç®¡ç†åŠ¨æ€èµ„æºæ—¶ï¼Œå®ç°ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦
2. **æ ‡è®°ç§»åŠ¨æ“ä½œä¸ºnoexcept**ï¼šæé«˜å®¹å™¨å¯¹ç§»åŠ¨æ“ä½œçš„ä½¿ç”¨æ„æ„¿
3. **åˆç†ä½¿ç”¨std::move**ï¼šä»…åœ¨ç¡®å®šä¸å†ä½¿ç”¨åŸå¯¹è±¡èµ„æºæ—¶ä½¿ç”¨
4. **é¿å…æ»¥ç”¨std::move**ï¼šå¯¹äºå°å‹å¯¹è±¡ï¼Œæ‹·è´å¯èƒ½æ¯”ç§»åŠ¨æ›´é«˜æ•ˆ
5. **ç†è§£å³å€¼å¼•ç”¨çš„ç‰¹æ€§**ï¼šå³å€¼å¼•ç”¨æœ¬èº«æ˜¯å·¦å€¼ï¼Œéœ€è¦å†æ¬¡ä½¿ç”¨std::moveæ‰èƒ½è½¬ç§»
6. **åˆ©ç”¨è¿”å›å€¼ä¼˜åŒ–ï¼ˆRVOï¼‰**ï¼šç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–è¿”å›å€¼ï¼Œæ— éœ€æ‰‹åŠ¨ä½¿ç”¨std::move

### 4. å¸¸è§è¯¯åŒº

- **std::moveä¼šç§»åŠ¨å¯¹è±¡**ï¼šé”™è¯¯ï¼Œstd::moveä»…è½¬æ¢ç±»å‹ï¼Œä¸æ‰§è¡Œç§»åŠ¨æ“ä½œ
- **ç§»åŠ¨ååŸå¯¹è±¡ä¸å¯ç”¨**ï¼šé”™è¯¯ï¼ŒåŸå¯¹è±¡ä»æœ‰æ•ˆï¼Œä½†èµ„æºå·²è¢«è½¬ç§»
- **æ‰€æœ‰å¯¹è±¡éƒ½é€‚åˆç§»åŠ¨**ï¼šé”™è¯¯ï¼Œå¯¹äºå°å‹å¯¹è±¡ï¼Œæ‹·è´å¯èƒ½æ›´é«˜æ•ˆ
- **å³å€¼å¼•ç”¨ä¸€å®šæ˜¯å³å€¼**ï¼šé”™è¯¯ï¼Œå³å€¼å¼•ç”¨æœ¬èº«æ˜¯å·¦å€¼

é€šè¿‡ç†è§£ç§»åŠ¨è¯­ä¹‰å’Œstd::moveå‡½æ•°çš„åŸç†ï¼Œå¼€å‘è€…å¯ä»¥ç¼–å†™æ›´é«˜æ•ˆçš„C++ä»£ç ï¼Œå‡å°‘ä¸å¿…è¦çš„å†…å­˜æ‹·è´ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“åœºæ™¯åˆç†ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œå¹³è¡¡æ€§èƒ½å’Œä»£ç å¯è¯»æ€§ã€‚