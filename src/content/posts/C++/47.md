---
title: 47.ä»–ä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„å—
order: 47
description: è¯¦è§£C++å®¹å™¨å’Œå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„çº¿ç¨‹å®‰å…¨é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
published: 2026-01-23
image: /assets/images/cpp-logo.webp
tags:
- å¤šçº¿ç¨‹
- çº¿ç¨‹å®‰å…¨
- å®¹å™¨
- å¹¶å‘
category: C++
---
# ğŸ”¬ ä»–ä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„å—
## ğŸ“‹ æ€»ç»“

ğŸ“– **å†…å®¹æ¦‚è§ˆ**
æœ¬æ–‡å°†è¯¦ç»†æ¢è®¨C++ä¸­å®¹å™¨çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒ…æ‹¬çº¿ç¨‹å®‰å…¨çš„å®šä¹‰ã€C++æ ‡å‡†å®¹å™¨çš„çº¿ç¨‹å®‰å…¨çº§åˆ«ã€ä¸åŒæ“ä½œçš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ï¼Œä»¥åŠå¦‚ä½•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨å®¹å™¨ã€‚é€šè¿‡æ·±å…¥ç†è§£è¿™äº›æ¦‚å¿µï¼Œå¼€å‘è€…å¯ä»¥åœ¨å¹¶å‘ç¼–ç¨‹ä¸­é¿å…æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§é—®é¢˜ã€‚
ğŸ“š **çº¿ç¨‹å®‰å…¨çš„åŸºæœ¬æ¦‚å¿µ**
### 1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨
**çº¿ç¨‹å®‰å…¨**æ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æˆ–èµ„æºæ—¶ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€æ•°æ®æ±¡æŸ“æˆ–ç¨‹åºå´©æºƒç­‰é—®é¢˜ã€‚çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒæ˜¯**æ•°æ®åŒæ­¥**ï¼Œç¡®ä¿åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå…±äº«èµ„æºåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä»¥å®‰å…¨çš„æ–¹å¼è®¿é—®ã€‚
**çº¿ç¨‹ä¸å®‰å…¨**åˆ™æ˜¯æŒ‡ä¸æä¾›æ•°æ®è®¿é—®ä¿æŠ¤æœºåˆ¶ï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€èµ„æºæ—¶å¯èƒ½å¯¼è‡´ï¼š
- **æ•°æ®ç«äº‰**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€å†…å­˜ä½ç½®
- **è„è¯»**ï¼šè¯»å–åˆ°éƒ¨åˆ†ä¿®æ”¹çš„æ•°æ®
- **ç«æ€æ¡ä»¶**ï¼šç¨‹åºæ‰§è¡Œç»“æœä¾èµ–äºçº¿ç¨‹æ‰§è¡Œçš„æ—¶åº
- **å†…å­˜ä¸ä¸€è‡´**ï¼šä¸åŒçº¿ç¨‹çœ‹åˆ°çš„æ•°æ®è§†å›¾ä¸ä¸€è‡´
### 1.2 çº¿ç¨‹å®‰å…¨çš„ä¿è¯æœºåˆ¶
ç¡®ä¿çº¿ç¨‹å®‰å…¨çš„ä¸»è¦æœºåˆ¶åŒ…æ‹¬ï¼š
1. **äº’æ–¥é”ï¼ˆMutexï¼‰**ï¼šä½¿ç”¨`std::mutex`æˆ–`std::lock_guard`ã€`std::unique_lock`ç­‰RAIIé”ç®¡ç†ç±»ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æº
2. **è¯»å†™é”ï¼ˆRead-Write Lockï¼‰**ï¼šä½¿ç”¨`std::shared_mutex`ï¼ˆC++17+ï¼‰ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–ï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥
3. **åŸå­æ“ä½œ**ï¼šä½¿ç”¨`std::atomic`ï¼Œæä¾›æ— é”çš„åŸå­è®¿é—®ï¼Œé€‚ç”¨äºç®€å•æ•°æ®ç±»å‹
4. **çº¿ç¨‹å±€éƒ¨å­˜å‚¨**ï¼šä½¿ç”¨`thread_local`ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬
5. **æ¶ˆæ¯ä¼ é€’**ï¼šé€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ®ï¼Œé¿å…ç›´æ¥å…±äº«å†…å­˜
6. **ä¸å¯å˜å¯¹è±¡**ï¼šå¯¹è±¡åˆ›å»ºåä¸å¯ä¿®æ”¹ï¼Œå¤©ç„¶çº¿ç¨‹å®‰å…¨
ğŸ¯ **C++æ ‡å‡†å®¹å™¨çš„çº¿ç¨‹å®‰å…¨çº§åˆ«**
C++æ ‡å‡†åº“å¯¹å®¹å™¨çš„çº¿ç¨‹å®‰å…¨æä¾›äº†**æœ€ä½ä¿éšœ**ï¼Œä½†ä¸æ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨çš„ã€‚æ ¹æ®C++æ ‡å‡†ï¼Œå®¹å™¨çš„çº¿ç¨‹å®‰å…¨åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªçº§åˆ«ï¼š
### 2.1 å®¹å™¨çš„åŸºæœ¬çº¿ç¨‹å®‰å…¨ä¿è¯
æ‰€æœ‰æ ‡å‡†å®¹å™¨ï¼ˆå¦‚`vector`ã€`list`ã€`map`ã€`unordered_map`ç­‰ï¼‰éƒ½æä¾›ä»¥ä¸‹åŸºæœ¬çº¿ç¨‹å®‰å…¨ä¿è¯ï¼š
1. **å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–**ï¼šå®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–åŒä¸€ä¸ªå®¹å™¨çš„å†…å®¹
2. **ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼Œå…¶ä»–çº¿ç¨‹è¯»å–**ï¼šä¸å®‰å…¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰
3. **å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥**ï¼šä¸å®‰å…¨ï¼Œä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º
### 2.2 ä¸åŒå®¹å™¨æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§
| æ“ä½œç±»å‹ | çº¿ç¨‹å®‰å…¨æ€§ | ç¤ºä¾‹ |
|---------|-----------|------|
| **è¯»å–æ“ä½œ** | çº¿ç¨‹å®‰å…¨ï¼ˆå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶è¯»å–ï¼‰ | `size()`ã€`empty()`ã€`front()`ã€`back()`ã€`find()` |
| **å†™å…¥æ“ä½œ** | ä¸å®‰å…¨ï¼ˆéœ€åŒæ­¥ï¼‰ | `push_back()`ã€`insert()`ã€`erase()`ã€`clear()` |
| **ä¿®æ”¹å…ƒç´ ** | ä¸å®‰å…¨ï¼ˆéœ€åŒæ­¥ï¼‰ | ç›´æ¥ä¿®æ”¹å®¹å™¨ä¸­çš„å…ƒç´ ï¼ˆå¦‚`vec[0] = 42`ï¼‰ |
| **å®¹å™¨æœ¬èº«ä¿®æ”¹** | ä¸å®‰å…¨ï¼ˆéœ€åŒæ­¥ï¼‰ | `resize()`ã€`reserve()`ã€`swap()` |
### 2.3 ç‰¹æ®Šæƒ…å†µï¼šå®¹å™¨çš„æˆå‘˜å‡½æ•°çº¿ç¨‹å®‰å…¨
æŸäº›å®¹å™¨çš„ç‰¹å®šæˆå‘˜å‡½æ•°æä¾›é¢å¤–çš„çº¿ç¨‹å®‰å…¨ä¿è¯ï¼š
- **`std::shared_ptr`**ï¼šå¼•ç”¨è®¡æ•°çš„ä¿®æ”¹æ˜¯åŸå­çš„ï¼Œä½†è®¿é—®å’Œä¿®æ”¹æŒ‡å‘çš„å¯¹è±¡ä¸æ˜¯
- **`std::mutex`**ï¼šæ‰€æœ‰æˆå‘˜å‡½æ•°éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
- **`std::atomic`**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œçº¿ç¨‹å®‰å…¨
ğŸ” **å¸¸è§å®¹å™¨çš„çº¿ç¨‹å®‰å…¨åˆ†æ**
### 3.1 é¡ºåºå®¹å™¨
- **`vector`**ï¼š
  - å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–ï¼šå®‰å…¨
  - ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼Œå…¶ä»–çº¿ç¨‹è¯»å–ï¼šä¸å®‰å…¨
  - å¤šä¸ªçº¿ç¨‹å†™å…¥ï¼šä¸å®‰å…¨
  - æ‰©å®¹æ—¶ä¼šå¯¼è‡´æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆï¼Œéœ€ç‰¹åˆ«æ³¨æ„
- **`list`**ï¼š
  - æ’å…¥/åˆ é™¤æ“ä½œåªå½±å“é™„è¿‘çš„èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹çš„è¿­ä»£å™¨ä»ç„¶æœ‰æ•ˆ
  - ä½†å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼šä¸å®‰å…¨
- **`deque`**ï¼š
  - å†™å…¥æ“ä½œï¼šä¸å®‰å…¨
  - ä¸¤ç«¯æ’å…¥/åˆ é™¤æ“ä½œçš„çº¿ç¨‹å®‰å…¨çº§åˆ«ä¸`vector`ç±»ä¼¼
### 3.2 å…³è”å®¹å™¨
- **`map`/`set`**ï¼š
  - æ’å…¥/åˆ é™¤æ“ä½œä¸ä¼šä½¿å…¶ä»–å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆ
- **`unordered_map`/`unordered_set`**ï¼š
  - æ’å…¥æ“ä½œå¯èƒ½å¯¼è‡´rehashï¼Œä½¿æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆ
### 3.3 å¹¶å‘å®¹å™¨ï¼ˆC++17+ï¼‰
C++17å¼•å…¥äº†**å¹¶å‘å®¹å™¨**ï¼Œä¸“é—¨è®¾è®¡ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒï¼š
| å¹¶å‘å®¹å™¨ | ç”¨é€” | çº¿ç¨‹å®‰å…¨ç‰¹æ€§ |
|---------|------|------------|
| `std::vector<std::atomic<T>>` | åŸå­å‘é‡ | æ¯ä¸ªå…ƒç´ çš„è®¿é—®æ˜¯åŸå­çš„ |
| `std::shared_mutex` | è¯»å†™é” | å…è®¸å¤šè¯»å•å†™ |
| æ³¨æ„ï¼šC++æ ‡å‡†åº“æœªæä¾›å®Œæ•´çš„å¹¶å‘å®¹å™¨ï¼Œå¦‚Javaçš„`ConcurrentHashMap` | | |
ğŸ› ï¸ **å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å®¹å™¨çš„æœ€ä½³å®è·µ**
### 4.1 1. ç²—ç²’åº¦é”ç­–ç•¥
**é€‚ç”¨åœºæ™¯**ï¼šå†™å…¥æ“ä½œé¢‘ç¹ï¼Œæˆ–éœ€è¦ä¿è¯æ“ä½œçš„åŸå­æ€§
**å®ç°æ–¹å¼**ï¼šä¸ºæ•´ä¸ªå®¹å™¨åŠ é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å®¹å™¨
```cpp
#include <vector>
#include <mutex>
#include <thread>
#include <iostream>

std::vector<int> data;
std::mutex data_mutex;

void write_to_vector(int value) {
    std::lock_guard<std::mutex> lock(data_mutex);
    data.push_back(value);
}

void read_from_vector() {
    std::lock_guard<std::mutex> lock(data_mutex); // è¯»å–æ—¶ä¹Ÿéœ€è¦åŠ é”
    for (int val : data) {
        std::cout << val << " ";
    }
    std::cout << std::endl;
}
```
### 4.2 2. ç»†ç²’åº¦é”ç­–ç•¥
**é€‚ç”¨åœºæ™¯**ï¼šå®¹å™¨è¾ƒå¤§ï¼Œä¸”ä¸åŒçº¿ç¨‹è®¿é—®å®¹å™¨çš„ä¸åŒéƒ¨åˆ†
**å®ç°æ–¹å¼**ï¼šä¸ºå®¹å™¨çš„ä¸åŒéƒ¨åˆ†åŠ é”ï¼Œæé«˜å¹¶å‘æ€§èƒ½
```cpp
#include <map>
#include <shared_mutex>
#include <string>

std::map<int, std::string> data_map;
std::shared_mutex map_mutex;

// è¯»å–æ“ä½œ - å…±äº«é”
std::string read_from_map(int key) {
    std::shared_lock<std::shared_mutex> lock(map_mutex);
    auto it = data_map.find(key);
    return it != data_map.end() ? it->second : "";
}

// å†™å…¥æ“ä½œ - ç‹¬å é”
void write_to_map(int key, const std::string& value) {
    std::unique_lock<std::shared_mutex> lock(map_mutex);
    data_map[key] = value;
}
```
### 4.3 3. çº¿ç¨‹å±€éƒ¨å®¹å™¨
**é€‚ç”¨åœºæ™¯**ï¼šæ¯ä¸ªçº¿ç¨‹éœ€è¦ç‹¬ç«‹çš„å®¹å™¨å®ä¾‹
**å®ç°æ–¹å¼**ï¼šä½¿ç”¨`thread_local`å­˜å‚¨ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å®¹å™¨å‰¯æœ¬
```cpp
#include <vector>
#include <thread>

thread_local std::vector<int> thread_local_data;

void process_data() {
    // æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„thread_local_dataå‰¯æœ¬
    thread_local_data.push_back(42);
    // è®¿é—®å’Œä¿®æ”¹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
    // ...
}
```
### 4.4 4. æ— é”æ•°æ®ç»“æ„
**é€‚ç”¨åœºæ™¯**ï¼šé«˜å¹¶å‘è¯»å†™ï¼Œå¯¹æ€§èƒ½è¦æ±‚æé«˜
**å®ç°æ–¹å¼**ï¼šä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”æ•°æ®ç»“æ„ï¼Œé¿å…é”çš„å¼€é”€
```cpp
#include <atomic>
#include <memory>

// ç®€å•çš„æ— é”æ ˆï¼ˆç®€åŒ–å®ç°ï¼‰
template <typename T>
class LockFreeStack {
private:
    struct Node {
        T data;
        Node* next;
        Node(const T& data) : data(data), next(nullptr) {}
    };
    
    std::atomic<Node*> head;
public:
    LockFreeStack() : head(nullptr) {}
    
    void push(const T& data) {
        Node* new_node = new Node(data);
        new_node->next = head.load(std::memory_order_relaxed);
        
        // åŸå­äº¤æ¢ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
        while (!head.compare_exchange_weak(new_node->next, new_node, 
                                           std::memory_order_release, 
                                           std::memory_order_relaxed));
    }
    
    // ç®€åŒ–çš„popå®ç°
    std::unique_ptr<T> pop() {
        Node* old_head = head.load(std::memory_order_relaxed);
        
        // åŸå­æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œç›´åˆ°æˆåŠŸ
        while (old_head && !head.compare_exchange_weak(old_head, old_head->next, 
                                                     std::memory_order_acquire, 
                                                     std::memory_order_relaxed));
        
        std::unique_ptr<T> result;
        if (old_head) {
            result = std::make_unique<T>(std::move(old_head->data));
            delete old_head;
        }
        return result;
    }
    
    // å…¶ä»–æ–¹æ³•...
};
```
### 4.5 5. ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—
**é€‚ç”¨åœºæ™¯**ï¼šçº¿ç¨‹é—´éœ€è¦ä¼ é€’æ•°æ®ï¼Œé¿å…ç›´æ¥å…±äº«å®¹å™¨
**å®ç°æ–¹å¼**ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œé€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ®
```cpp
#include <queue>
#include <condition_variable>
#include <mutex>
#include <memory>

// çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—
template <typename T>
class ThreadSafeQueue {
private:
    std::queue<T> queue;
    mutable std::mutex mutex;
    std::condition_variable cond_var;

public:
    ThreadSafeQueue() = default;
    
    ThreadSafeQueue(const ThreadSafeQueue&) = delete;
    ThreadSafeQueue& operator=(const ThreadSafeQueue&) = delete;
    
    // å…¥é˜Ÿæ“ä½œ
    void push(T value) {
        std::lock_guard<std::mutex> lock(mutex);
        queue.push(std::move(value));
        cond_var.notify_one();
    }
    
    // éé˜»å¡å‡ºé˜Ÿ
    bool try_pop(T& value) {
        std::lock_guard<std::mutex> lock(mutex);
        if (queue.empty()) {
            return false;
        }
        value = std::move(queue.front());
        queue.pop();
        return true;
    }
    
    // é˜»å¡å‡ºé˜Ÿï¼Œç›´åˆ°æœ‰å…ƒç´ æˆ–è¶…æ—¶
    bool wait_pop(T& value, std::chrono::milliseconds timeout) {
        std::unique_lock<std::mutex> lock(mutex);
        
        // ä½¿ç”¨è¶…æ—¶ç­‰å¾…æ¡ä»¶å˜é‡
        if (!cond_var.wait_for(lock, timeout, [this] { return !queue.empty(); })) {
            return false;
        }
        
        value = std::move(queue.front());
        queue.pop();
        return true;
    }
    
    // æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
    bool empty() const {
        std::lock_guard<std::mutex> lock(mutex);
        return queue.empty();
    }
};
```
ğŸ’» **çº¿ç¨‹å®‰å…¨çš„å®¹å™¨å°è£…**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„`vector`å°è£…ç¤ºä¾‹ï¼Œä½¿ç”¨äº’æ–¥é”ä¿è¯æ‰€æœ‰æ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼š
```cpp
#include <vector>
#include <algorithm>
#include <iterator>
#include <mutex>
#include <stdexcept>

// çº¿ç¨‹å®‰å…¨çš„vectorå°è£…
template <typename T>
class ThreadSafeVector {
private:
    std::vector<T> data;
    mutable std::mutex mutex;

public:
    ThreadSafeVector() = default;
    
    ThreadSafeVector(const ThreadSafeVector& other) {
        std::lock_guard<std::mutex> lock(other.mutex);
        data = other.data;
    }
    
    ThreadSafeVector& operator=(const ThreadSafeVector& other) {
        if (this != &other) {
            std::lock_guard<std::mutex> lock1(mutex);
            std::lock_guard<std::mutex> lock2(other.mutex);
            data = other.data;
        }
        return *this;
    }
    
    // åŸºç¡€æ“ä½œ
    void push_back(const T& value) {
        std::lock_guard<std::mutex> lock(mutex);
        data.push_back(value);
    }
    
    void push_back(T&& value) {
        std::lock_guard<std::mutex> lock(mutex);
        data.push_back(std::move(value));
    }
    
    bool empty() const {
        std::lock_guard<std::mutex> lock(mutex);
        return data.empty();
    }
    
    size_t size() const {
        std::lock_guard<std::mutex> lock(mutex);
        return data.size();
    }
    
    // è®¿é—®æ“ä½œ
    T at(size_t index) const {
        std::lock_guard<std::mutex> lock(mutex);
        return data.at(index);
    }
    
    // è¿­ä»£æ“ä½œ
    template <typename Func>
    void for_each(Func func) {
        std::lock_guard<std::mutex> lock(mutex);
        std::for_each(data.begin(), data.end(), func);
    }
    
    // æŸ¥æ‰¾æ“ä½œ
    bool contains(const T& value) const {
        std::lock_guard<std::mutex> lock(mutex);
        return std::find(data.begin(), data.end(), value) != data.end();
    }
    
    // ä¿®æ”¹æ“ä½œ
    void clear() {
        std::lock_guard<std::mutex> lock(mutex);
        data.clear();
    }
    
    void erase(size_t index) {
        std::lock_guard<std::mutex> lock(mutex);
        if (index < data.size()) {
            data.erase(data.begin() + index);
        } else {
            throw std::out_of_range("Index out of range");
        }
    }
};
```
âš ï¸ **å¸¸è§çº¿ç¨‹å®‰å…¨é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**
### 6.1 è¿­ä»£å™¨å¤±æ•ˆé—®é¢˜
**é—®é¢˜**ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿­ä»£å®¹å™¨æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å®¹å™¨ï¼Œå¯èƒ½å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆ
**è§£å†³æ–¹æ¡ˆ**ï¼š
- è¿­ä»£æœŸé—´é”å®šæ•´ä¸ªå®¹å™¨
- ä½¿ç”¨å¿«ç…§ï¼šå…ˆå¤åˆ¶å®¹å™¨å†…å®¹ï¼Œç„¶ååœ¨å‰¯æœ¬ä¸Šè¿­ä»£
- ä½¿ç”¨æ”¯æŒå®‰å…¨è¿­ä»£çš„å®¹å™¨ï¼ˆå¦‚æŸäº›ç¬¬ä¸‰æ–¹åº“çš„å¹¶å‘å®¹å™¨ï¼‰
### 6.2 æ­»é”é—®é¢˜
**é—®é¢˜**ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´ç¨‹åºå¡æ­»
- å§‹ç»ˆæŒ‰ç…§ç›¸åŒçš„é¡ºåºè·å–é”
- ä½¿ç”¨`std::lock`æˆ–`std::scoped_lock`ï¼ˆC++17+ï¼‰åŒæ—¶è·å–å¤šä¸ªé”
- é¿å…åœ¨æŒæœ‰é”æ—¶è°ƒç”¨æœªçŸ¥å‡½æ•°
- ä½¿ç”¨è¶…æ—¶æœºåˆ¶ï¼Œå¦‚`std::unique_lock::try_lock_for`
### 6.3 è™šå‡å”¤é†’é—®é¢˜
**é—®é¢˜**ï¼šæ¡ä»¶å˜é‡å¯èƒ½åœ¨æ²¡æœ‰è¢«æ˜¾å¼é€šçŸ¥çš„æƒ…å†µä¸‹é†’æ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨æ¡ä»¶å˜é‡çš„ç­‰å¾…å¾ªç¯ä¸­æ£€æŸ¥å®é™…æ¡ä»¶
- ä½¿ç”¨`while`è€Œä¸æ˜¯`if`æ¥ç­‰å¾…æ¡ä»¶

```cpp
// æ­£ç¡®åšæ³•
std::unique_lock<std::mutex> lock(mutex);
cond_var.wait(lock, [this] { return !queue.empty(); });
// ç­‰ä»·äº
while (queue.empty()) {
    cond_var.wait(lock);
}
```

ğŸ“‹ **æ€»ç»“**
### 7.1 C++å®¹å™¨çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒè¦ç‚¹
1. **æ ‡å‡†å®¹å™¨ä¸æ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨çš„**ï¼šåªä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å®‰å…¨ï¼Œå†™å…¥å’ŒåŒæ—¶è¯»å†™éƒ½ä¸å®‰å…¨
2. **éœ€è¦æ˜¾å¼åŒæ­¥**ï¼šä½¿ç”¨é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ä¿æŠ¤å…±äº«å®¹å™¨
3. **é€‰æ‹©åˆé€‚çš„åŒæ­¥ç­–ç•¥**ï¼šç²—ç²’åº¦é”ã€ç»†ç²’åº¦é”ã€çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€æ— é”ç»“æ„æˆ–æ¶ˆæ¯ä¼ é€’
4. **æ³¨æ„è¿­ä»£å™¨å¤±æ•ˆ**ï¼šä¿®æ”¹å®¹å™¨æ—¶å¯èƒ½å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆ
5. **è€ƒè™‘å¹¶å‘å®¹å™¨**ï¼šC++17+æä¾›äº†ä¸€äº›å¹¶å‘æ”¯æŒï¼Œä½†å®Œæ•´çš„å¹¶å‘å®¹å™¨éœ€ä¾èµ–ç¬¬ä¸‰æ–¹åº“
### 7.2 æœ€ä½³å®è·µæ€»ç»“
1. **æœ€å°åŒ–å…±äº«æ•°æ®**ï¼šå‡å°‘çº¿ç¨‹é—´å…±äº«çš„æ•°æ®é‡ï¼Œé™ä½åŒæ­¥å¼€é”€
2. **ä¼˜å…ˆä½¿ç”¨åŸå­ç±»å‹**ï¼šå¯¹äºç®€å•æ•°æ®ï¼Œä½¿ç”¨`std::atomic`æ¯”é”æ›´é«˜æ•ˆ
3. **åˆç†é€‰æ‹©é”çš„ç²’åº¦**ï¼šæ ¹æ®è®¿é—®æ¨¡å¼é€‰æ‹©ç²—ç²’åº¦æˆ–ç»†ç²’åº¦é”
4. **é¿å…é”çš„åµŒå¥—**ï¼šå‡å°‘æ­»é”é£é™©
5. **ä½¿ç”¨RAIIç®¡ç†é”**ï¼šé¿å…å¿˜è®°é‡Šæ”¾é”
6. **è€ƒè™‘æ— é”è®¾è®¡**ï¼šå¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œæ— é”æ•°æ®ç»“æ„å¯èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½
7. **ä½¿ç”¨æ¶ˆæ¯ä¼ é€’**ï¼šé€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ®ï¼Œé¿å…ç›´æ¥å…±äº«å†…å­˜
### 7.3 çº¿ç¨‹å®‰å…¨çš„æƒè¡¡
çº¿ç¨‹å®‰å…¨æ€»æ˜¯ä¼´éšç€**æ€§èƒ½å¼€é”€**ï¼Œéœ€è¦åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼š
- **å®Œå…¨çº¿ç¨‹å®‰å…¨**ï¼šæœ€é«˜çš„å®‰å…¨æ€§ï¼Œä½†å¯èƒ½å¸¦æ¥è¾ƒå¤§çš„æ€§èƒ½å¼€é”€
- **éƒ¨åˆ†çº¿ç¨‹å®‰å…¨**ï¼šæ ¹æ®å®é™…éœ€æ±‚æä¾›å¿…è¦çš„åŒæ­¥ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½
- **æ— é”è®¾è®¡**ï¼šæœ€é«˜çš„æ€§èƒ½ï¼Œä½†å®ç°å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œæ€§èƒ½è¦æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„çº¿ç¨‹å®‰å…¨ç­–ç•¥ï¼Œç¡®ä¿ç¨‹åºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ—¢èƒ½æ­£ç¡®è¿è¡Œï¼Œåˆèƒ½ä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚