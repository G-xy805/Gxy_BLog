---
import type { CollectionEntry } from "astro:content";
import { render } from "astro:content";
import { formatDateToYYYYMMDD } from "@/utils/date-utils";

interface Props {
	class?: string;
	entry: CollectionEntry<"posts">;
	title: string;
	url: string;
	published: Date;
	image: string;
	description: string;
	style: string;
}
const { entry, title, url, published, image, description, style } = Astro.props;
const className = Astro.props.class;

const hasCover = image !== undefined && image !== null && image !== "";

const { remarkPluginFrontmatter } = await render(entry);
---


<div
  class:list={[
    "card-base post-card flex flex-col md:flex-row w-full min-h-24 h-auto rounded-[var(--radius-large)] overflow-hidden relative scroll-animation hover-lift",
    className,
  ]}
  style={style}
>
  <!-- 卡片装饰元素 -->
  <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-[var(--primary)] to-transparent opacity-10 rounded-bl-full pointer-events-none"></div>
  <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-[var(--secondary)] to-transparent opacity-10 rounded-tr-full pointer-events-none"></div>
  
  <div
    class:list={[
      "pl-6 md:pl-8 pt-6 md:pt-8 pb-6 md:pb-8 relative flex flex-col flex-1",
      {
        "order-2 md:order-1 pr-6 md:pr-6": hasCover,
        "pr-6 md:pr-8": !hasCover,
      },
    ]}
  >
    <div class="flex-1 flex flex-col">
      <!-- 标签展示 -->
      {remarkPluginFrontmatter.tags && remarkPluginFrontmatter.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-4">
          {remarkPluginFrontmatter.tags.slice(0, 3).map((tag: string) => (
            <span class="inline-block px-3 py-1 text-xs font-semibold bg-gradient-to-r from-[var(--primary)]/15 to-[var(--secondary)]/15 text-[var(--primary)] rounded-full transition-all hover:from-[var(--primary)]/25 hover:to-[var(--secondary)]/25 hover:scale-105 hover:-translate-y-0.5">
              {tag}
            </span>
          ))}
        </div>
      )}
      
      <!-- 文章标题 -->
      <a
        href={url}
        class="transition group w-full block font-bold mb-3 text-xl md:text-2xl text-[#394E6A] bg-clip-text bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] hover:text-transparent post-card-title"
      >
        {title}
      </a>

      <!-- 文章摘要 -->
      <div
        class:list={[
          "transition text-sm md:text-base text-base-content/70 pr-4 description line-clamp-3 leading-relaxed",
          { "md:line-clamp-2": !description },
        ]}
      >
        {description || remarkPluginFrontmatter.excerpt}
      </div>

      <!-- 文章元信息 -->
      <div class="mt-auto flex flex-wrap justify-between items-center text-sm text-base-content/60 pt-5 gap-4">
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-[var(--primary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <span>{formatDateToYYYYMMDD(published)}</span>
        </div>
        
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-[var(--secondary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          <span>{remarkPluginFrontmatter.words} 字 · {remarkPluginFrontmatter.minutes} 分钟</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 文章封面图 -->
  {
    hasCover && (
      <a
        href={url}
        aria-label={title}
        class:list={[
          "group",
          "w-full md:w-2/5 lg:w-2/5 aspect-video overflow-hidden order-1 md:order-2 rounded-tl-[var(--radius-large)] rounded-tr-[var(--radius-large)] md:rounded-tl-none md:rounded-tr-[var(--radius-large)] md:rounded-r-[var(--radius-large)] relative hover-lift",
        ]}
      >
        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-400 z-10"></div>
        <div class="absolute inset-0 bg-gradient-to-br from-[var(--primary)]/10 to-[var(--secondary)]/10 opacity-0 group-hover:opacity-100 transition-opacity duration-400 z-10"></div>
        <img
          src={image}
          alt="Cover Image of the Post"
          class="w-full h-full object-cover transition-all duration-800 group-hover:scale-110 group-hover:rotate-1 rounded-tl-[var(--radius-large)] rounded-tr-[var(--radius-large)] md:rounded-tl-none md:rounded-tr-[var(--radius-large)] md:rounded-r-[var(--radius-large)]"
          loading="lazy"
        />
        <div class="absolute bottom-4 right-4 bg-white/90 dark:bg-black/70 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-[var(--text-color)] opacity-0 group-hover:opacity-100 transition-opacity duration-400 z-20">
          查看详情
        </div>
      </a>
    )
  }
</div>


