---
import { Icon } from "astro-icon/components";
import { commentConfig } from "@/config";
import I18nKey from "@/i18n/i18nKey";
import { i18n } from "@/i18n/translation";
import { formatDateToYYYYMMDD } from "@/utils/date-utils";

export interface Props {
	published: Date;
	hidePublishDate?: boolean;
	hidePageViews?: boolean;
	isHome?: boolean;
	className?: string;
	id?: string;
	words?: number;
	minutes?: number;
	showWordCount?: boolean; // 是否显示字数统计，默认false显示标签
	customPath?: string;
}

const {
	published,
	hidePublishDate,
	hidePageViews,
	isHome,
	className = "",
	id,
	words,
	minutes,
	showWordCount = false,
	customPath,
} = Astro.props;

const path = customPath || (id ? `/posts/${id}` : "");
---

<div
  class:list={[
    "flex flex-wrap post-meta-text items-center gap-4 gap-x-4 gap-y-2",
    className,
  ]}
>
  <!-- publish date -->
  {!hidePublishDate && (
    <div class="flex items-center">
      <div class="meta-icon">
        <Icon
          name="ri:calendar-line"
          class="text-xl"
        />
      </div>
      <span class="post-meta-text text-sm font-medium"
        >{formatDateToYYYYMMDD(published)}</span
      >
    </div>
  )}





   <!-- word count and read time (only for post list) -->
   {
     showWordCount && words !== undefined && minutes !== undefined && (
       <>
         <!-- word count -->
         <div class="flex items-center">
           <div class="meta-icon">
             <Icon
          name="ri:file-text-line"
          class="text-xl"
        />
           </div>
            <div class="post-meta-text text-sm font-medium">
              {words}
              {" " + i18n(words === 1 ? I18nKey.wordCount : I18nKey.wordsCount)}
            </div>
         </div>
         
         <!-- read time -->
         <div class="flex items-center">
           <div class="meta-icon">
             <Icon
          name="ri:time-line"
          class="text-xl"
        />
           </div>
            <div class="post-meta-text text-sm font-medium">
              {minutes}
              {" " +
                i18n(minutes === 1 ? I18nKey.minuteCount : I18nKey.minutesCount)}
            </div>
         </div>
       </>
     )
   }



  <!-- Twikoo访问量统计（首页不显示，且文章访问量统计启用时显示） -->
  {!hidePageViews && !isHome &&
      commentConfig.type === 'twikoo' &&
      commentConfig.twikoo?.visitorCount &&
      id && (
        <div class="flex items-center">
          <div class="meta-icon">
            <Icon
          name="ri:eye-line"
          class="text-xl"
        />
          </div>
          <span class="post-meta-text text-sm font-medium mr-1">
            {i18n(I18nKey.pageViews)}
          </span>
          <span class="post-meta-text text-sm font-medium" id="twikoo_visitors">
            {i18n(I18nKey.pageViewsLoading)}
          </span>
        </div>
      )
  }
  <!-- Waline访问量统计（首页不显示、仅type为waline时显示） -->
  {!hidePageViews && !isHome &&
      commentConfig.type === 'waline' &&
      commentConfig.waline?.visitorCount &&
      id && (
        <div class="flex items-center">
          <div class="meta-icon">
            <Icon name="ri:eye-line" class="text-xl" />
          </div>
          <span class="post-meta-text text-sm font-medium mr-1">
            {i18n(I18nKey.pageViews)}
          </span>
          <span class="post-meta-text text-sm font-medium waline-pageview-count" data-path={path}>{i18n(I18nKey.pageViewsLoading)}</span>
        </div>
      )
  }
    <!-- artalk访问量统计（首页不显示、仅type为artalk时显示） -->
    {!hidePageViews && !isHome &&
        commentConfig.type === 'artalk' &&
        commentConfig.waline?.visitorCount &&
        id && (
                    <div class="flex items-center">
                        <div class="meta-icon">
                            <Icon name="ri:eye-line" class="text-xl" />
                        </div>
                        <span class="post-meta-text text-sm font-medium mr-1">
                            {i18n(I18nKey.pageViews)}
                        </span>
                        <span class="post-meta-text text-sm font-medium artalk-pv-count" data-path={path}>{i18n(I18nKey.pageViewsLoading)}</span>
                    </div>
        )
    }
</div>
