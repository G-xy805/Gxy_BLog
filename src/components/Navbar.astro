---      
import { Icon } from "astro-icon/components";
import ThemeToggle from "./widgets/ThemeToggle.astro";
import { SITE_TITLE, SITE_MENU } from "../config";      
      
// Get current path to determine active link      
const currentPath = Astro.url.pathname;      
      
// Type safely process SITE_MENU before rendering      
type SubMenuItem = {      
  id: string;      
  text: string;      
  href: string;      
  svg: string;      
  target?: string;      
};      
      
type MenuItem = {      
  id: string;      
  text: string;      
  href: string;      
  svg: string;      
  target?: string;      
  subItems?: SubMenuItem[];      
};      
      
// Ensure the menu is properly typed      
const typedMenu = SITE_MENU as MenuItem[];      
---      
      
<!-- 桌面端透明导航栏 -->      
<nav class="fixed top-0 left-0 right-0 z-50 hidden md:block transition-opacity duration-500 opacity-100 pointer-events-auto" id="navbar-desktop">      
  <div class="max-w-blog mx-auto px-4">      
    <!-- 透明背景，添加毛玻璃效果 -->      
    <div id="navbar-bg" class="bg-base-100 border border-base-200 px-6 py-3 rounded-tl-none rounded-tr-none rounded-bl-2xl rounded-br-2xl shadow-2xl transition-colors duration-300">      
      <div class="flex items-center justify-between">      

        <!-- 品牌标识 - 使用主题色 -->        
        <a href="/" class="flex items-center space-x-2 hover:scale-105 transition-transform duration-300">        
          <span class="text-3xl font-bold tracking-tight text-primary">{SITE_TITLE}</span>        
        </a>      
              
        <!-- 桌面端水平菜单 - 响应主题颜色 -->
        <div class="flex items-center space-x-1">
          {typedMenu.map((item) => (
            // 跳过首页菜单
            item.href !== '/' && (
              item.subItems ? (
                <div class="dropdown dropdown-hover">
                  <div tabindex="0" role="button" class="nav-item btn btn-ghost text-xl md:text-3xl lg:text-xl font-bold px-4 py-2 rounded-xl hover:bg-white/10 transition-all duration-200 text-base-content dark:text-white">
                    <span>{item.text}</span>
                    <Icon name="feather:chevron-down" class="ml-2 h-4 w-4" />
                  </div>
                  <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-lg bg-base-100 rounded-xl border border-base-200 w-52 -mt-0.5 text-base-content">
                    {item.subItems.map((subItem) => (
                      <li>
                        <a
                          href={subItem.href}
                          target={subItem.target || "_self"}
                          class="px-4 py-2 hover:bg-base-200 rounded-xl text-base font-bold transition-all duration-200"
                        >
                          {subItem.text}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ) : (
                <a
                  href={item.href}
                  target={item.target || "_self"}
                  class="nav-item btn btn-ghost text-lg font-bold px-4 py-2 rounded-xl hover:bg-white/10 transition-all duration-200 text-base-content dark:text-white"
                >
                  {item.text}
                </a>
              )
            )
          ))}
        </div>      
              
        <!-- 右侧工具栏 -->
        <div class="flex items-center space-x-2">
          <!-- 搜索图标 -->
          <a href="/blog/search" class="btn btn-ghost btn-circle hover:bg-white/10" aria-label="搜索">
            <Icon name="feather:search" class="h-5 w-5 text-primary" />
          </a>
          <!-- 主题切换 -->
          <ThemeToggle className="btn btn-ghost btn-circle hover:bg-white/10 text-primary" />
        </div>      
      </div>      
    </div>      
  </div>      
</nav>      
      
<!-- 移动端顶部悬浮导航栏 -->
<nav id="navbar-mobile" class="fixed top-0 left-0 right-0 z-50 md:hidden transition-all duration-500 ease-in-out">
  <div class="max-w-blog mx-auto px-2 pt-2">
    <div class="flex items-center justify-between px-4 py-3 bg-base-100/80 backdrop-blur-xl rounded-full shadow-2xl border border-base-200 w-full">
      {typedMenu.map((item) => {
        const isActive = currentPath === item.href || (item.href !== '/' && currentPath.startsWith(item.href));
        const isHome = item.href === '/';
        
        if (item.subItems) {
          // 有子菜单的项 - 添加下拉功能
          return (
            <div class="dropdown dropdown-bottom">
              <div 
                tabindex="0" 
                role="button"
                class:list={[
                  "relative flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 group",
                  isActive ? "text-primary" : "text-base-content/60 hover:text-primary"
                ]}
                aria-label={item.text}
              >
                {isActive && (
                  <span class="absolute inset-0 bg-primary/10 rounded-full -z-10 scale-110"></span>
                )}
                <div class="relative flex items-center justify-center">
                  <Icon name={item.svg} class="w-6 h-6" />
                </div>
              </div>
              <ul tabindex="0" class="dropdown-content z-[100] menu p-2 shadow-2xl bg-base-200 rounded-box w-48 mt-4 translate-x-[-50%] left-1/2">
                {item.subItems.map((subItem) => (
                  <li>
                    <a
                      href={subItem.href}
                      target={subItem.target || "_self"}
                      class="flex items-center gap-2 p-2 hover:bg-base-300 rounded-lg w-full"
                    >
                      <Icon name={subItem.svg} class="w-4 h-4" />
                      <span>{subItem.text}</span>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          );
        } else {
          // 没有子菜单的项 - 保持原样
          return (
            <a
              href={item.href}
              class:list={[
                "relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 group",
                isActive && !isHome ? "text-primary" : "text-base-content/60 hover:text-primary"
              ]}
              aria-label={item.text}
            >
              {isActive && !isHome && (
                <span class="absolute inset-0 bg-primary/10 rounded-full -z-10 scale-110"></span>
              )}
              {isHome ? (
                <div class:list={["relative w-12 h-12 rounded-full overflow-hidden border-2 transition-colors duration-300", isActive ? "border-primary" : "border-transparent group-hover:border-primary/50"]}>
                  <img src="/goat.png" alt={item.text} class="w-full h-full object-cover" />
                </div>
              ) : (
                <Icon name={item.svg} class="w-6 h-6" />
              )}
            </a>
          );
        }
      })}

      {/* 移动端主题切换 */}
      <div class="relative flex items-center justify-center w-10 h-10">
        <ThemeToggle className="btn btn-ghost btn-circle hover:bg-white/10 text-primary" />
      </div>
    </div>
  </div>
</nav>
      
<script>
  document.addEventListener("astro:page-load", () => {
    // 导航栏淡入淡出逻辑
    let lastScrollY = window.scrollY;
    const navbarDesktop = document.getElementById("navbar-desktop");
    const navbarMobile = document.getElementById("navbar-mobile");
    
    // 搜索功能：按'/'键跳转到搜索页面
    document.addEventListener("keydown", (e) => {
      const target = e.target as HTMLElement;
      if (e.key === "/" && target && target.tagName !== "INPUT" && target.tagName !== "TEXTAREA") {
        e.preventDefault();
        window.location.href = "/blog/search";
      }
    });

    function handleScroll() {
      const currentScrollY = window.scrollY;
      const isScrollingDown = currentScrollY > lastScrollY && currentScrollY > 50;

      // 桌面端处理
      if (navbarDesktop) {
        if (isScrollingDown) {
          navbarDesktop.classList.add("opacity-0", "pointer-events-none");
          navbarDesktop.classList.remove("opacity-100", "pointer-events-auto");
        } else {
          navbarDesktop.classList.remove("opacity-0", "pointer-events-none");
          navbarDesktop.classList.add("opacity-100", "pointer-events-auto");
        }
      }

      // 移动端处理
      if (navbarMobile) {
        if (isScrollingDown) {
          // 向下滑动隐藏：向上平移并透明
          navbarMobile.classList.add("-translate-y-32", "opacity-0", "pointer-events-none");
        } else {
          // 向上滑动显示：恢复原位
          navbarMobile.classList.remove("-translate-y-32", "opacity-0", "pointer-events-none");
        }
      }

      lastScrollY = currentScrollY;
    }

    let ticking = false;
    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });
    
    // 初始化执行一次以设置正确状态
    handleScroll();
  });
</script>