---
import { Icon } from "astro-icon/components";
import { licenseConfig } from "@/config/licenseConfig";
import { profileConfig } from "@/config/profileConfig";
import { siteConfig } from "@/config/siteConfig";
import { sponsorConfig } from "@/config/sponsorConfig";
import I18nKey from "@/i18n/i18nKey";
import { i18n } from "@/i18n/translation";
import { formatDateToYYYYMMDD } from "@/utils/date-utils";
import { getCategoryUrl, getTagUrl } from "@/utils/url-utils";

interface Props {
	title: string;
	pubDate: Date;
	class: string;
	licenseName: string;
	licenseUrl: string;
	category?: string;
	tags?: string[];
	words?: number;
	minutes?: number;
}

const { title, pubDate, licenseName, licenseUrl, category, tags, words, minutes } = 
	Astro.props;
const profileConf = profileConfig;
const licenseConf = licenseConfig;
---

<hr />
<div class="container p-0 my-4">
  <div class="text-right text-sm text-base-content/60 dark:text-gray-300 italic mb-2">
    <Icon name="feather:heart" class="w-4 h-4 inline-block align-text-bottom text-[#E58B8B] dark:text-[#FF79C6]" /> Thanks for reading!
  </div>

  <div class="bg-[var(--license-block-bg)] rounded-xl overflow-visible pt-12 pb-6 px-6 relative">
    <!-- License Icon -->
      <div class="absolute -top-8 left-8">
        <div class="w-16 h-16 bg-blue-500 dark:bg-[#FF79C6] rounded-full flex items-center justify-center shadow-lg">
          <Icon name="ri:creative-commons-line" class="w-10 h-10 text-white dark:text-black" />
        </div>
      </div>

    <!-- Article Metadata -->
    <div class="space-y-4">
      <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 dark:text-white">{title}</h3>

      <!-- Stats Row -->
      <div class="flex flex-wrap justify-start items-center gap-2 sm:gap-4 text-sm text-gray-600 dark:text-gray-300">
        <span>{formatDateToYYYYMMDD(pubDate)}</span>
        {words && minutes && (
          <div class="flex items-center gap-1">
            <span>{words} {i18n(I18nKey.wordsCount)}</span>
            <span class="text-xs">·</span>
            <span>{minutes} {i18n(minutes === 1 ? I18nKey.minuteCount : I18nKey.minutesCount)}</span>
          </div>
        )}
      </div>

      <!-- Categories and Tags -->
      <div class="flex flex-wrap items-center gap-3 mt-2">
        <!-- Categories -->
        {category && category.trim() && (
          <a href={getCategoryUrl(category)} class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-[#E6F0FF] dark:bg-[#36313F] text-[var(--primary)] hover:bg-[var(--primary)]/10 transition-colors font-bold">
            <Icon name="feather:folder" class="w-4 h-4" />
            <span>{category}</span>
          </a>
        )}
        
        <!-- Tags -->
        {tags && tags.length > 0 && tags.map((tag: string) => (
          <a href={getTagUrl(tag)} class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-[#EAEDFA] dark:bg-[#323241] text-[#463AA2] dark:text-[#BD93F9] hover:bg-gray-200 dark:hover:bg-[#44475A] transition-colors font-bold">
            <Icon name="feather:tag" class="w-4 h-4 text-[#463AA2] dark:text-[#BD93F9]" />
            <span>{tag}</span>
          </a>
        ))}
        
        <!-- No category message -->
        {!category && (
          <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-[#EAEDFA] dark:bg-[#36313F] text-black/50 dark:text-white/50 font-bold">
            <Icon name="feather:folder" class="w-4 h-4" />
            <span>无分类</span>
          </span>
        )}
        
        <!-- No tags message -->
        {tags && tags.length === 0 && (
          <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm bg-[#EAEDFA] dark:bg-[#323241] text-[#463AA2]/50 dark:text-[#BD93F9] opacity-80 font-bold">
            <Icon name="feather:tag" class="w-4 h-4 text-[#463AA2]/50 dark:text-[#BD93F9]" />
            <span>无标签</span>
          </span>
        )}
      </div>

      <!-- License Info -->
      <hr class="my-4 border-gray-300 dark:border-gray-600" />
      <div class="flex justify-between items-center flex-wrap gap-4">
        <div class="text-sm text-gray-600 dark:text-gray-300">
          © {profileConf.name} |
          <a
            href={licenseName ? licenseUrl || undefined : licenseConf.url}
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors ml-1"
          >
            {licenseName || licenseConf.name}
          </a>
        </div>
        <div class="flex gap-3">
          <!-- Support Button -->
        {sponsorConfig.showButtonInPost && siteConfig.pages.sponsor && (
          <a href="/sponsor/" class="btn bg-[#C148AC] hover:bg-[#a83c96] text-white font-bold px-5 py-2 rounded-lg transition-colors">
            打赏作者
          </a>
        )}
          
          <button class="btn bg-[var(--btn-regular-bg)] hover:bg-[var(--btn-regular-bg-hover)] text-[var(--btn-content)] border border-blue-600 font-bold px-5 py-2 rounded-lg transition-colors flex items-center gap-2" onclick={`navigator.clipboard.writeText(window.location.href).then(() => {
            const toast = document.getElementById('copy-toast');
            if (toast) {
              toast.classList.remove('opacity-0', 'translate-y-4');
              setTimeout(() => toast.classList.add('opacity-0', 'translate-y-4'), 2000);
            }
          })`}>
            分享 <Icon name="feather:share-2" class="w-5 h-5" />
          </button>
        </div>
        
        <!-- Toast Notification -->
        <div id="copy-toast" class="absolute left-1/2 -translate-x-1/2 bottom-24 transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-50 w-max">
          <div class="bg-[#81CFD1] shadow-lg py-3 px-6 text-base flex items-center gap-2 rounded-lg">
            <Icon name="feather:check-circle" class="w-5 h-5 text-black" />
            <span class="text-black">已复制链接</span>
          </div>
        </div>
      </div>
    </div>
  </div>



</div>


